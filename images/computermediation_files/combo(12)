YUI.add("hermes-template-html4-balls",function(e,a){var r=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,r,t,l){return'\n<div class="html4-balls"></div>\n'},useData:!0}),t={};e.Array.each([],function(a){var r=e.Template.get("hermes/"+a);r&&(t[a]=r)}),e.Template.register("hermes/html4-balls",function(a,l){return l=l||{},l.partials=l.partials?e.merge(t,l.partials):t,r(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("html5-balls",function(e){var l,t=!(e.UA.ie&&e.UA.ie<9);l=function(e){return t?"html5-balls":"html4-balls"},e.augment(l,e.Attribute),e.Balls=l},"@VERSION@",{requires:["base","hermes-template-html5-balls","hermes-template-html4-balls","handlebars-helpers","template-base"]});YUI.add("fluid-share-panel-view",function(e,t){function i(e){return e.displayUrl||e.url||e.src}var s=require("hermes-core/flog")(t),a=require("url-parse"),n={},r=["sq","t","q","s","n","m","z","c","b","l","h","k"],l={header:"false",footer:"false",context:"false",vr:"false"};n["embed-code-size-field"]="embed-code-text-field",n["iframe-code-size-field"]="iframe-code-text-field",n["bb-code-size-field"]="bb-code-text-field",e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.networkClasses=t.networkClasses||{},this.linkShareParams=t.linkShareParams,this.guestPassParams=t.guestPassParams||{},this.emailShareParams=t.emailShareParams,this.signedOutSharingPerms=t.signedOutSharingPerms||{},this.shareItemCount=t.shareItemCount||1,this.PERMISSIONS=[],this.guestPassParams.canSharePrivate&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_PRIVATE"}),value:"private"}),!1!==this.guestPassParams.shareNonPublic&&(this.guestPassParams.contentMarkedFriendFamily&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_FRIENDS_AND_FAMILY"}),value:"family_and_friends"}),this.guestPassParams.contentMarkedFamily&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_FAMILY"}),value:"family"}),this.guestPassParams.contentMarkedFriends&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_FRIENDS"}),value:"friends"})),this.guestPassParams.contentMarkedPublic&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_PUBLIC_ONLY"}),value:"public"}),this.isMine=t.isMine||!1,this.cancel=!1,this.guestPasses={},this.flickrShare={recipients:[],guestpassStr:this.PERMISSIONS[0]?this.PERMISSIONS[0].value:"private"},this.appContext.flipper.isFlipped("enable-share-restyle")&&(l=e.StorageHelper.getItem("embedr-options")?JSON.parse(e.StorageHelper.getItem("embedr-options")):l),t.canVr?l.vr="true":l.vr="false",this},loadState:function(){var t=[],i=this;if(this.appContext.getViewer().nsid&&t.push(this.appContext.getModel("person-models",this.appContext.getViewer().nsid).then(function(e){i.set("me",e)})),this.guestPassParams.shareToAll)Object.keys(this.signedOutSharingPerms).forEach(function(e){i.networkClasses[e].canShare=!0});else if(this.guestPassParams.shareToSpecific)Object.keys(this.guestPassParams.shareToSpecific).forEach(function(e){i.networkClasses[e].canShare=i.guestPassParams.shareToSpecific[e].canShare,i.networkClasses[e].canNotShareTitle=i.guestPassParams.shareToSpecific[e].canNotShareTitle});else{var s={};s[this.emailShareParams.modelName+"_id"]=this.emailShareParams.modelId,this.emailShareParams.modelOwnerId&&(s.owner_id=this.emailShareParams.modelOwnerId),t.push(this._loadSharingPermissionsFromAPI(s))}return e.Promise.all(t)},_loadSharingPermissionsFromAPI:function(e){var t=this;return e.breakCache=(new Date).toISOString(),this.appContext.callAPI("flickr.sharing.canShare",e).then(function(e){e&&e.services&&e.services.service&&e.services.service.forEach(function(e){Object.keys(t.networkClasses).some(function(i){if(t.networkClasses[i].serviceId===e.serviceTypeId){if(t.networkClasses[i].canShare=!!e.canShare,"flickr"===i&&!1===t.appContext.getViewer().signedIn&&(t.networkClasses[i].canShare=!1),e.canShare||(t.networkClasses[i].canNotShareTitle=e.reason.map(function(e){return e.content}).join(", ")),130===e.serviceTypeId&&e.reason&&e.reason.length&&e.reason.some(function(e){return 3===e.code}))return t.cancelMessage=t.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_RESTRICTED"}),t.cancel=!0,!0;if(130===e.serviceTypeId){if(t.PERMISSIONS.length&&"public"!==t.PERMISSIONS[t.PERMISSIONS.length-1].value&&(t.guestpassRequired=!0),e.availableGuestpasses){1===e.guestpassRequired&&t.PERMISSIONS.length&&"public"===t.PERMISSIONS[t.PERMISSIONS.length-1].value&&t.PERMISSIONS.shift(),1===e.guestpassRequired&&(t.guestpassRequired=!0,t.guestPassParams=t.guestPassParams||{},t.guestPassParams.contentMarkedPublic=!1,t.guestPassParams.nonPublicWarning=!0);var s=!1,a=!1,n=!1;e.availableGuestpasses.guestpass.forEach(function(e){"friends"===e.content&&(s=!0),"family"===e.content&&(a=!0),"private"===e.content&&(n=!0)});for(var r=0;r<t.PERMISSIONS.length;)"friends"===t.PERMISSIONS[r].value&&!s||"family"===t.PERMISSIONS[r].value&&!a||"family_and_friends"===t.PERMISSIONS[r].value&&!a&&!s||"private"===t.PERMISSIONS[r].value&&!n?t.PERMISSIONS.splice(r,1):r++}else t.PERMISSIONS.length&&"public"===t.PERMISSIONS[t.PERMISSIONS.length-1].value&&(t.PERMISSIONS=[t.PERMISSIONS[0]]);t.flickrShare.guestpassStr=t.PERMISSIONS[0]?t.PERMISSIONS[0].value:"private"}return!0}return!1})})},function(e){s.error("Error reading canShare permissions",{err:e}),Object.keys(t.signedOutSharingPerms).forEach(function(e){t.networkClasses[e].canShare=t.signedOutSharingPerms[e].canShare})})},buildContainer:function(){var t,i=this.guestPassParams.showGuestPassDropdown&&this.isMine&&!!this.guestPassParams.type||!this.guestPassParams.contentMarkedPublic,s="";if(this.cancel)return this.setContainerWithTemplate("fluid-share-panel-error",{errorMessage:this.cancelMessage||this.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_ERROR",photoCount:this.guestPassParams.multipleItems?2:1})}),this;if(this.linkShareDisplay=this.generateLinkSharingDisplay(this.linkShareParams),s="macintosh"===e.UA.os?this.intlMessage({intlName:"share-modal.COPY_MAC"}):this.intlMessage({intlName:"share-modal.COPY_PC"}),t={networkClasses:this.networkClasses,linkShareDisplay:this.linkShareDisplay,privacyWarningString:this.linkShareParams.privacyWarningString,downloadAccessString:this.linkShareParams.downloadAccessString,showDownloadWarning:this.linkShareParams.showDownloadWarning,shareItemCount:this.shareItemCount,grabLink:this.guestPassParams.contentMarkedPublic||this.linkShareParams.generateLink?this.linkShareParams.shortURL:null,canHaveGuestpass:i,emailShareParams:this.emailShareParams,showMailPerms:this.guestPassParams.showGuestPassDropdown&&this.isMine&&this.guestPassParams.multipleItems&&this.PERMISSIONS.length>0,nonPublicWarning:this.guestPassParams.nonPublicWarning,grabLinkDefaultPermission:(i&&this.PERMISSIONS.length)>0?this.PERMISSIONS[0].text:"",copyMessage:s,choiceOfPermission:this.PERMISSIONS.length>1,displayOptions:l,showSlideshowOption:void 0!==this.linkShareParams.albumId||void 0!==this.linkShareParams.galleryId,isEdge:this.appContext.getUA().isEdge},this.linkShareDisplay.embedr){var a,n=0,o=e.StorageHelper.getItem("fluid-share-panel-embedr-default-size");this.linkShareDisplay.embedr.sizes.forEach(function(e,t){if(o&&e.sizeKey===o&&(n=t,a=!0),!a){r.indexOf(e.sizeKey)>n&&(n=t)}}),t.defaultSizeStr=this.linkShareDisplay.embedr.sizes[n].sizeStr,t.defaultEmbedrCode=this.linkShareDisplay.embedr.sizes[n].embedCode,e.StorageHelper.setItem("fluid-share-panel-embedr-default-size",this.linkShareDisplay.embedr.sizes[n].sizeKey)}if(this.linkShareDisplay.bbCode){var h,d=0,c=e.StorageHelper.getItem("fluid-share-panel-bbCode-default-size");this.linkShareDisplay.bbCode.sizes.forEach(function(e,t){if(c&&e.sizeKey===c&&(d=t,h=!0),!h){r.indexOf(e.sizeKey)>d&&(d=t)}}),t.defaultBBCode=this.linkShareDisplay.bbCode.sizes[d].embedCode,t.defaultBBCodeSizeStr=this.linkShareDisplay.bbCode.sizes[d].sizeStr}if(this.linkShareDisplay.iframe){var m,u=0,p=e.StorageHelper.getItem("fluid-share-panel-iframe-default-size");this.linkShareDisplay.iframe.sizes.forEach(function(e,t){if(p&&e.sizeKey===p&&(u=t,m=!0),!m){r.indexOf(e.sizeKey)>u&&(u=t)}}),t.defaultIframeSizeStr=this.linkShareDisplay.iframe.sizes[u].sizeStr,t.defaultIframeCode=this.linkShareDisplay.iframe.sizes[u].embedCode}return this.linkShareDisplay.bbCode||this.linkShareDisplay.embedr||this.linkShareDisplay.iframe||(t.hideButtons=!0),t.moveInstructionsUp=t.hideButtons&&!t.canHaveGuestpass&&!t.choiceOfPermission,this.appContext.flipper.isFlipped("enable-share-restyle")?this.setContainerWithTemplate("fluid-share-panel-restyle",t):this.setContainerWithTemplate("fluid-share-panel",t),this},additionalViewClasses:function(){var e=[];return this.appContext.flipper.isFlipped("enable-share-restyle")&&e.push("restyle"),e},activate:function(){var t=this.get("container"),i=this;if(this.registerEventHandler(t.delegate("click",function(e){e.preventDefault(),i.fire("subviewViewEvent","done-sharing")},".done-sharing")),this.guestpassRequired&&this.fire("subviewViewEvent","guestpass-required"),this.cancel)return this;this.dropdowns={},this.linkShareDisplay||(this.linkShareDisplay=this.generateLinkSharingDisplay(this.linkShareParams)),this.registerEventHandler(e.globalEvents.subscribe("window:keydown",function(t){(t.e.ctrlKey||t.e.metaKey)&&67===t.e.keyCode&&e.rapidTracker.beacon(i.name,"linkCopied-"+e.StorageHelper.getItem("fluid-share-panel-first-selected"))})),this.registerEventHandler(t.delegate(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode||(e.preventDefault(),i._toggleLinkSelection(e,t))},".link-type-button")),this.registerEventHandler(t.delegate("change",function(e){e.currentTarget.getDOMNode().checked?(t.one(".embed-privacy-container").addClass("hide"),t.one(".embed-options-container").removeClass("hide")):(t.one(".embed-privacy-container").removeClass("hide"),t.one(".embed-options-container").addClass("hide"))},".embed-guestpass-checkbox")),this.registerEventHandler(t.delegate("click",function(e){e.preventDefault(),i._createdDropdownForEmbedIframeBB.bind(i)(e,t)},".embed-size-field")),this.registerEventHandler(t.delegate("click",function(e){e.preventDefault(),i._createGrabLinkPermissionDropdown(e,t)},".grab-link-field")),this.registerEventHandler(t.delegate("click",function(e){e.preventDefault(),i._createMailPermissionDropdown(e,t)},".mail-perm-field")),this.registerEventHandler(t.delegate("click",function(e){e.target.select()},".bb-code-text-field, .grab-link-text-field, .embed-code-text-field")),this.registerEventHandler(t.delegate("click",function(s){i.networkClasses&&s.target.ancestor("."+i.networkClasses.flickr.className,!0)&&(s.preventDefault(),t.one(".share-panels").addClass("show-email-form"),e.rapidTracker.beacon(i.name,"emailTabClick"))},".share-link.sharing-type-enabled")),!this.appContext.flipper.isFlipped("enable-share-restyle")&&t.one(".leave-email-sharing")&&this.registerEventHandler(t.one(".leave-email-sharing").on("click",function(e){e.preventDefault(),t.one(".share-panels").removeClass("show-email-form")})),t.one(".share-by-email")&&this.registerEventHandler(t.one(".share-by-email").on("click",function(e){e.preventDefault(),i._onShareByEmail(e)})),i.appContext.flipper.isFlipped("enable-embedr-in-share")&&i.appContext.flipper.isFlipped("enable-share-restyle")&&this.registerEventHandler(t.delegate("change",function(e){e.halt(),i._updateEmbedrOptions(e)},".embed-options input")),this.setupEmailSharing();var s=this.PERMISSIONS[0].value;if(!this.linkShareParams.generateLink&&((this.appContext.flipper.isFlipped("enable-public-guestpass")||this.guestpassRequired)&&this.isMine&&-1===this.linkShareParams.url.indexOf("favorites")||"public"!==s)){"public"!==s&&t.one(".grab-link-privacy-reminder").removeClass("hide-reminder");var a=[1,1,1];"friends"===s?a=[0,1,0]:"family"===s?a=[1,0,0]:"family_and_friends"===s&&(a=[1,1,0]),this.requestGuestpass.apply(this,a)}if(this.linkShareParams.generateLink&&(t.one(".grab-link-privacy-reminder").removeClass("hide-reminder"),this.generatingLink||(this.generatingLink=!0,this.startGuestpassLoader(),this.fire("subviewViewEvent","generate-link"))),!this.appContext.flipper.isFlipped("enable-share-restyle")){var n=e.OverflowHelper.detectScrollbarSize(e.one("body"));t.one(".message-form")&&t.one(".message-form").setStyle("paddingRight",n+"px"),t.one(".share-by-email")&&t.one(".share-by-email").setStyle("marginRight",n+"px"),t.one(".share-panel-body")&&t.one(".share-panel-body").setStyle("paddingRight",n+"px")}return this.setHighlightWidths(),t.one(".grab-link-download-reminder a").addClass("tabbable"),this},onParentViewEvent:function(t,i){var s=this.get("container"),n=s.one(".grab-link-text-field"),r=e.StorageHelper.getItem("fluid-share-panel-first-selected")||"grabLinkItem";if("flickr-share-error"===i[0])this._onWarning(this.intlMessage({intlName:"share-modal.FLICKR_SHARE_ERROR"}));else if("flickr-share-success"===i[0]){var l=s.one(".fake-input");l.removeClass("not-empty"),l.all(".pill").remove(),s.one(".email-message-text-field").set("value",""),s.one(".email-recipient-text-field").setStyle("width","inherit"),s.one(".share-by-email").set("disabled",!0),this.contacts.resetSearch(),this.to={},this.flickrShare.recipients=[],this._onWarning(this.intlMessage({intlName:"share-modal.FLICKR_SHARE_SUCCESS"}),this.intlMessage({intlName:"share-modal.FLICKR_SHARE_SUCCESS_TITLE"}),!0)}else if("guestpass-created"===i[0]){this.guestPasses[""+i[1]]=i[2],n.set("value",i[2]),"grabLinkItem"===r&&n.select(),this.endGuestpassLoader();var o=s.one(".embed-code-text-field");if(o){var h=s.one(".embed-code-text-field").get("value"),d=/href=".*?"/,c='href="'+i[2]+'"';o.set("value",h.replace(d,c)),this.linkShareParams.url=a(i[2]).pathname,this.linkShareDisplay.embedr.sizes.forEach(function(e){e.embedCode&&(e.embedCode=e.embedCode.replace(d,c))}),this.linkShareDisplay.embedr.sizes=this.linkShareDisplay.embedr.sizes.filter(function(e){return"o"!==e.sizeKey})}}else"guestpass-failed"===i[0]?(s.one(".grab-link-permission-label")&&s.one(".grab-link-permission-label").set("text",this.intlMessage({intlName:"share-modal.SHARE_PUBLIC_ONLY"})),n.set("value",this.linkShareParams.shortURL),this.endGuestpassLoader(),this._onWarning(this.intlMessage({intlName:"share-modal.GUESTPASS_CREATION_FAILURE"}))):"generated-link"===i[0]&&(s.one(".grab-link-text-field").set("text",i[1]),n.set("value",i[1]),n.select(),this.endGuestpassLoader())},setHighlightWidths:function(){var t,i,s,a,n=this.get("container"),r=n.one(".link-type-highlight"),l=0,o=n.one(".link-grab-type-button").getDOMNode().offsetLeft,h=e.StorageHelper.getItem("fluid-share-panel-first-selected")||"grabLinkItem";for(t=[{name:"grabLinkItem",element:n.one(".link-grab-type-button")},{name:"embedItem",element:n.one(".embed-type-button")},{name:"iframeItem",element:n.one(".iframe-type-button")},{name:"emailItem",element:n.one(".email-type-button")},{name:"bbCodeItem",element:n.one(".bbcode-type-button")}],this.highlightWidths={},a=0;a<t.length;a++)(s=t[a]).element?(l=parseInt(s.element.get("clientWidth"),10),this.highlightWidths[s.name]={width:l,left:o+"px"},o+=l+24):s.name===h&&(h="grabLinkItem");1===Object.keys(this.highlightWidths).length&&(h="grabLinkItem"),i=t.filter(function(e){return e.name===h})[0].element,r.setStyles(this.highlightWidths[h]),this._toggleLinkSelection({target:i},n)},_toggleLinkSelection:function(t,i){var s,a=i.one(".link-type-highlight"),n=t.target.ancestor(".link-type-buttons",!0).get("children").indexOf(t.target);i.one(".share-link-types").toggleClass("first-stop",0===n).toggleClass("second-stop",1===n).toggleClass("third-stop",2===n).toggleClass("fourth-stop",3===n),t.target.hasClass("link-grab-type-button")?(s=this.highlightWidths.grabLinkItem,i.one(".grab-link-text-field").select(),e.StorageHelper.setItem("fluid-share-panel-first-selected","grabLinkItem"),e.rapidTracker.beacon(this.name,"grabLinkTabClick"),this.manageTabbables(".grab-link-only")):t.target.hasClass("embed-type-button")?(s=this.highlightWidths.embedItem,this.linkShareParams.isNonPublic||i.one(".embed-code-text-field").select(),e.StorageHelper.setItem("fluid-share-panel-first-selected","embedItem"),e.rapidTracker.beacon(this.name,"embedTabClick")):t.target.hasClass("iframe-type-button")?(s=this.highlightWidths.iframeItem,i.one(".iframe-code-text-field").select(),e.StorageHelper.setItem("fluid-share-panel-first-selected","iframeItem"),e.rapidTracker.beacon(this.name,"iframeTabClick")):t.target.hasClass("bbcode-type-button")?(s=this.highlightWidths.bbCodeItem,i.one(".bb-code-text-field").select(),e.StorageHelper.setItem("fluid-share-panel-first-selected","bbCodeItem"),e.rapidTracker.beacon(this.name,"bbCodeTabClick")):t.target.hasClass("email-type-button")&&(this.appContext.getViewer().signedIn?(s=this.highlightWidths.emailItem,e.StorageHelper.setItem("fluid-share-panel-first-selected","emailItem"),e.rapidTracker.beacon(this.name,"emailTabClick")):this.fire("subviewViewEvent","confirm-sign-in"),this.manageTabbables(".email-sharing-panel")),a.setStyles(s)},_createDropdown:function(t,i,s,a,n){var r=this;n&&!n.isClosed||((n=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,hideModalOverlay:!0,classList:"over-modal",overlayClassList:"over-modal",anchorElement:t.one("."+i+" .dropdown-arrow"),observePageResize:!0,menuItems:s,forceLeft:!0,anchorOffsetHorizontal:16,closeOnResize:!0})).on("selected",function(e){n.close(),a.bind(r)(e),r.setHighlightWidths()}),n.show())},_createdDropdownForEmbedIframeBB:function(t,i){var s,a,l,o;t.target.ancestor(".embed-size-field",!0).hasClass("embed-code-size-field")?(s="embed-code-size-field",a="embedr"):t.target.ancestor(".embed-size-field",!0).hasClass("iframe-code-size-field")?(s="iframe-code-size-field",a="iframe"):t.target.ancestor(".embed-size-field",!0).hasClass("bb-code-size-field")&&(s="bb-code-size-field",a="bbCode"),l=this.linkShareDisplay[a].sizes,o=r.concat(["o"]),this._createDropdown(i,s,Object.keys(l).map(function(e){return{text:l[e].sizeStr,value:l[e].sizeKey}}).sort(function(e,t){return o.indexOf(e.value)<o.indexOf(t.value)?-1:1}),function(t){var r;t&&t.menuItem&&(l.some(function(e){return e.sizeKey===t.menuItem.value&&(r=e.sizeKey,i.one("."+n[s]).set("value",e.embedCode),i.one("."+s).one(".embed-code-label").set("text",e.sizeStr),!0)}),e.StorageHelper.setItem("fluid-share-panel-"+a+"-default-size",r))},this.dropdowns[a])},_createGrabLinkPermissionDropdown:function(e,t){var i=this;this._createDropdown(t,"grab-link-field",this.PERMISSIONS,function(e){if(e&&e.menuItem){var s=e.menuItem.value,a=t.one(".grab-link-text-field"),n=t.one(".grab-link-privacy-reminder");if(t.one(".grab-link-permission-label").set("text",e.menuItem.text),"public"===s)a.set("value",i.linkShareParams.shortURL),n.addClass("hide-reminder");else{var r=0,l=0,o=0;"friends"===s?r=1:"family"===s&&(l=1),"family_and_friends"===s?(l=1,r=1):"private"===s&&(o=1),n.removeClass("hide-reminder"),i.requestGuestpass(l,r,o)}}},this.dropdowns.grabLink)},_createMailPermissionDropdown:function(e,t){var i=this;this._createDropdown(t,"mail-perm-field",this.PERMISSIONS,function(e){e&&e.menuItem&&(t.one(".mail-permission-label").set("text",e.menuItem.text),i.flickrShare.guestpassStr=e.menuItem.value)},this.dropdowns.mail)},_onShareByEmail:function(e){this.fire("subviewViewEvent","share-by-email",{recipients:this.flickrShare.recipients,guestpassStr:this.flickrShare.guestpassStr,message:this.get("container").one(".email-message-text-field").get("value")})},manageTabbables:function(e){var t=this.get("container");t.all(".link-type-content:not("+e+") .tabbable").setAttribute("tabindex","-1"),t.all(e+" .tabbable").setAttribute("tabindex","0")},generateLinkSharingDisplay:function(t){var s=this,a={link:t.url,isNonPublic:t.isNonPublic},n=t.sizes?Object.keys(t.sizes):[];return n.length>0&&t.supportsEmbedr&&(s.appContext.flipper.isFlipped("enable-embedr-in-share")?a.embedr={sizes:Object.keys(t.sizes).map(function(a){return{sizeKey:a,sizeStr:s.getSizeStr(a)+" "+t.sizes[a].width+" × "+t.sizes[a].height,embedCode:s.templates("fluid-share-embedr-code")({embedLink:e.url(t.url),title:t.title,farmURL:e.URLHelper.addProtocolToURL(i(t.sizes[a])),width:t.sizes[a].width,height:t.sizes[a].height,alt:t.title,displayOptions:l,showSlideshowOption:void 0!==s.linkShareParams.albumId||void 0!==s.linkShareParams.galleryId})}})}:(a.embedr={sizes:Object.keys(t.sizes).map(function(a){return{sizeKey:a,sizeStr:s.getSizeStr(a)+" "+t.sizes[a].width+" × "+t.sizes[a].height,embedCode:s.templates("fluid-share-old-html-embed-code")({embedLink:e.url(t.url),title:t.title,authorName:t.author,farmURL:e.URLHelper.addProtocolToURL(i(t.sizes[a])),width:t.sizes[a].width,height:t.sizes[a].height,alt:t.title})}})},a.iframe={sizes:Object.keys(t.sizes).map(function(a){var n;return"/"!==(n=e.config.win.location.href)[n.length-1]&&(n+="/"),n+="player/",{sizeKey:a,sizeStr:s.getSizeStr(a)+" "+t.sizes[a].width+" × "+t.sizes[a].height,embedCode:s.templates("fluid-share-old-iframe-embed-code")({embedLink:n,title:t.title,farmURL:e.URLHelper.addProtocolToURL(i(t.sizes[a])),width:t.sizes[a].width,height:t.sizes[a].height,alt:t.title})}})})),n.length>0&&t.supportsBBCode&&(a.bbCode={sizes:Object.keys(t.sizes).map(function(a){return{sizeKey:a,sizeStr:s.getSizeStr(a)+" "+t.sizes[a].width+" × "+t.sizes[a].height,embedCode:s.templates("fluid-share-bb-code")({title:t.title,farmURL:e.URLHelper.addProtocolToURL(i(t.sizes[a])),shortURL:t.shortURL,authorURL:e.url(t.authorURL),authorName:t.author})}})}),a},getSizeStr:function(e){var t="";return["sq","q"].indexOf(e)>-1?t=this.intlMessage({intlName:"common.SQUARE"}):"t"===e?t=this.intlMessage({intlName:"common.THUMBNAIL"}):["s","n"].indexOf(e)>-1?t=this.intlMessage({intlName:"common.SMALL"}):["m","z","c"].indexOf(e)>-1?t=this.intlMessage({intlName:"common.MEDIUM"}):["l","h","k"].indexOf(e)>-1?t=this.intlMessage({intlName:"common.LARGE"}):"o"===e&&(t=this.intlMessage({intlName:"common.ORIGINAL"})),t},requestGuestpass:function(e,t,i){var s=this.get("container").one(".grab-link-text-field"),a=""+e+t+i;if(this.guestPasses[a])s.set("value",this.guestPasses[a]);else{var n={is_private:i,is_family:e,is_friend:t},r=this.guestPassParams.type,l=this.guestPassParams.id;"photo"===r&&(n.photo=l),"photostream"===r&&(n.photostream=l),"set"===r&&(n.set=l),this.startGuestpassLoader(),this.fire("subviewViewEvent","request-guestpass",a,n)}},startGuestpassLoader:function(){var e=this;setTimeout(function(){if(!e.guestpassLoaded){var t=e.get("container").one(".grab-link-loader");t.setStyle("display","block"),t.addClass("show-loader")}},50)},endGuestpassLoader:function(){var e=this.get("container").one(".grab-link-loader");this.guestpassLoaded=!0,e.removeClass("show-loader"),setTimeout(function(){this.guestpassLoaded&&e.setStyle("display","none")}.bind(this),500)},setupEmailSharing:function(){var t=this.get("container"),i=t.one(".email-recipient-text-field"),s=this.fakeInput=t.one(".fake-input"),a=this.input=this.get("container").one('[data-field="recipient"]'),n=t.one(".email-message-text-field"),r=t.one(".share-by-email"),l=this;this.focus&&(setTimeout(function(){i.focus()},100),this.focus=!1),i&&(this.to={},this.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>'),i.on("focus",function(){s.addClass("focus"),""===a.get("value")?l.contacts.hide():l.contacts.search(),l._adjustInputWidth()}),i.on("blur",function(){a.ancestor(".fake-input").one(".pill")||t.one(".email-recipient-text-field").setStyle("width","inherit")}),a.on("blur",function(){var e,t=!1;(e=l.contacts.selected)&&e.email&&(t=!0,l._makePill(e,t),l.contacts.selected=null,l.get("container").one(".fake-input").insertBefore(a,l.contacts.wrapperEl)),s.removeClass("focus")}),a.on("keydown",function(e){var t,i;8===e.keyCode?(""===this.get("value")&&(i=l.get("container").all(".pill").pop())&&i.fire("remove"),setTimeout(function(){l._adjustInputWidth()},0)):(13===e.keyCode||9===e.keyCode&&!e.shiftKey||32===e.keyCode||188===e.keyCode)&&((t=l.contacts.selected)&&t.email?(e.preventDefault(),l._makePill(t),l.contacts.selected=null,l._arrangeInput()):13!==e.keyCode||l.contacts.selected||(e.preventDefault(),""===this.get("value")&&l.get("container").one('[data-field="message"]').focus()))}),a.on("keypress",function(e){var t=this.get("value");l._adjustInputWidth(t+String.fromCharCode(e.which)),l.contacts._reposition(),this.show()}),a.on("keyup",function(t){0===e.Object.size(l.to)&&""===l.input.get("value")?r.setAttribute("disabled",!0):r.removeAttribute("disabled"),8===t.keyCode&&""===this.get("value")&&l._arrangeInput()}),n.on("keydown",function(e){9!==e.keyCode||e.shiftKey||(e.preventDefault(),r.focus())}),this.appContext.flipper.isFlipped("enable-share-restyle")||n.on("keyup",function(t){var i=""===n.get("value").trim(),s=0===e.Object.size(l.to)&&""===l.input.get("value");i||s?r.setAttribute("disabled",!0):r.removeAttribute("disabled")}),s.delegate("click",function(e){l._arrangeInput()},".fake-input"),s.delegate("mouseover",function(e){var t=e.currentTarget,i=s.get("clientWidth"),a=t.get("offsetLeft"),n=parseInt(t.getComputedStyle("width").replace("px",""),10);l.appContext.flipper.isFlipped("enable-share-restyle")&&(a=t.get("offsetLeft")-s.get("offsetLeft")),i-a-n-10>0?(t.addClass("not-eol"),t.removeClass("end-of-the-line")):(t.removeClass("not-eol"),t.addClass("end-of-the-line"))},".pill"),this.contacts=new e.ContactSearchBox({el:i,appContext:this.appContext,shim:"c-contact-search-shim",signedOut:!this.appContext.getViewer().signedIn,alwaysDownward:!0,DOMContainer:t.one(".share-panel-body").getDOMNode(),loadingState:this.templates(e.Balls())(),onError:function(){i.blur(),l.contacts.hide()},onShow:function(e){var t=l.get("container"),i=l.get("container").one(".contact-list");t.on("click",function(e){"INPUT"!==e.target.get("tagName")&&"block"===i.getStyle("display")&&l.contacts.hide()})},onSelect:function(e,t){e&&e.nsid&&(l._makePill(e),l._arrangeInput())},dialogOffset:function(){var e=l.fakeInput.getDOMNode().getBoundingClientRect(),t=l.input.getDOMNode().getBoundingClientRect();return e.height-t.height+10}}))},_adjustInputWidth:function(t){var i,s,a,n=this.get("container"),r=n.one(".share-by-email"),l=this;return t=t||this.input.get("value"),0===e.Object.size(this.to)&&""===t?((s=n.one(".fake-input")).removeClass("not-empty"),i=s.get("clientWidth"),""!==n.one(".email-message-text-field").get("value").trim()&&r.setAttribute("disabled",!0),this.input.setStyle("width",i-20),setTimeout(function(){l.input.focus()},10),i):((a=e.Node.create('<span class="width-check"></span>')).set("innerHTML",escape(t)),this.get("container").appendChild(a),i=a.get("clientWidth")||0,a.remove(),this.input.setStyle("width",(i||30)+5+"px"),setTimeout(function(){l.input.focus()},10),i)},_makePill:function(e,t){var i,s=escape(e.realname||e.email),a=this.templates("share-modal-mail-pill")({value:s}),n=this.get("container"),r=n.one(".share-by-email"),l=n.one(".fake-input"),o=this;l.addClass("not-empty"),""!==n.one(".email-message-text-field").get("value").trim()&&r.removeAttribute("disabled"),this.to[s]=e,o.completeSameEvent&&o.completeSameEvent.detach(),(i=l.insertBefore(a,this.contacts.wrapperEl)).on("remove",function(t){e.nsid?o.contacts.showInSearch(e.nsid):e.email&&!t&&(o.input.set("value",i.one("span:first-child").get("innerHTML")),o._adjustInputWidth()),delete o.to[s],i.remove(),o.flickrShare.recipients.some(function(t,i){return!!(t.nsid&&t.nsid===e.nsid||!t.nsid&&t.name&&t.name===e.name)&&(o.flickrShare.recipients.splice(i,1),!0)})}),i.delegate("click",function(e){e.stopPropagation(),i.fire("remove",!0),o.input.focus()},".remove-tag"),i.on("dblclick",function(t){t.stopPropagation();var a=o.input;a.set("value",s),o._adjustInputWidth(s),i.replace(a),i.fire("remove"),setTimeout(function(){a.focus()},10),o.contacts.search(),o.completeSameEvent=a.once("blur",function(t){a.get("value")===s&&(o._makePill(e),o.input.set("value",""),o._arrangeInput())})}),e.nsid&&this.contacts.hideFromSearch(e.nsid),this.flickrShare.recipients.push(e),this.input.set("value",""),t||(this.input.focus(),o._adjustInputWidth())},_arrangeInput:function(){var e=this.input;this.get("container").one(".fake-input").insertBefore(e,this.contacts.wrapperEl),setTimeout(function(){e.focus()},10)},_onWarning:function(t,i,s){var a=e.Node.create(this.templates("fluid-warning")({message:t,title:i})),n=e.Node.create("<div></div>"),r=this.get("container"),l=this,o=(r.get("clientWidth")+20)/2-260,h=(r.get("clientHeight")+20)/2-60;a.setStyle("width",500),a.setStyle("height",100),a.setStyle("left",o),a.setStyle("top",h),n.setStyle("left",0),n.setStyle("top",0),n.setStyle("width","100%"),n.setStyle("height","100%"),n.addClass("warning-modal"),r.append(n),n.append(a),n.on("click",function(){n.remove(!0),s&&l.fire("subviewViewEvent","closeAll")})},_updateEmbedrOptions:function(t){var i=t.target.getData("setting"),s=t.target.getDOMNode().checked,a=this.get("container"),r=e.StorageHelper.getItem("fluid-share-panel-embedr-default-size"),o=a.one(".embed-demo-container");l[i]=s?"true":"false",this.linkShareDisplay=this.generateLinkSharingDisplay(this.linkShareParams),this.linkShareDisplay.embedr.sizes.some(function(e){if(e.sizeKey===r)return a.one("."+n["embed-code-size-field"]).set("value",e.embedCode),a.one(".embed-code-size-field").one(".embed-code-label").set("text",e.sizeStr),!0}),"true"===l.header?o.addClass("show-header"):o.removeClass("show-header"),"true"===l.footer?o.addClass("show-footer"):o.removeClass("show-footer"),a.one(".embed-code-text-field").select(),e.StorageHelper.setItem("embedr-options",JSON.stringify(l))}})},"@VERSION@",{requires:["flickr-view","promise","hermes-template-fluid-share-panel","hermes-template-fluid-share-panel-restyle","fluid-droparound-view","hermes-template-fluid-share-embedr-code","hermes-template-fluid-share-bb-code","hermes-template-share-modal-mail-pill","hermes-template-fluid-warning","hermes-template-fluid-share-panel-error","hermes-template-fluid-share-old-html-embed-code","hermes-template-fluid-share-old-iframe-embed-code","fluid-modal-view","contact-search-box","html5-balls","overflow-helper","url-helper","storage-helper"],optionalRequires:["global-events"],langBundles:["share-modal","common"]});YUI.add("hermes-lang-share-modal",function(e,o){e.Intl.add("hermes/share-modal","en-US",{SHARE_ON_BLOGGER:["Share on Blogger"],SHARE_PHOTO:["Share Photo"],SHARE_PHOTOS:["Share photos"],SHARE_VIDEO:["Share Video"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_BLOGGER:["please authorize Flickr to post on Blogger"],SHARE_ON_FACEBOOK:["Share on Facebook"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_FACEBOOK:["please authorize Flickr to post on Facebook"],SHARE_VIA_MAIL:["Share via mail"],SHARE_ON_TUMBLR:["Share on Tumblr"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TUMBLR:["please authorize Flickr to post on Tumblr"],PUBLISH_NOW:["Publish now"],ADD_TO_QUEUE:["Add to queue"],SAVE_AS_DRAFT:["Save as draft"],SHARE_ON_TWITTER:["Share on Twitter"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TWITTER:["please authorize Flickr to post on Twitter"],SHARE_PHOTOSTREAM:["Share photostream"],SHARE_ALBUM:["Share album"],SHARE_FAVORITES:["Share favorites"],AUTHORIZE_TO_SHARE:["You need to authorize Flickr to share photos on ","${service}"],CONNECT_TO_SERVICE:["Connect to ","${service}"],OK_TAKE_ME_TO_MY_SETTINGS:["OK, take me to my settings"],POST:["Post"],SHARE:["Share"],FRIENDS:["Friends"],FAMILY:["Family"],SCREEN_NAME_OR_EMAIL:["Screen name or email"],INCLUDE_A_MESSAGE:["Include a message"],SHARE_THIS_VIA:["Share this via..."],SHARE_PREFERENCES:["share preferences"],GRAB_THE_LINK:["Grab the link"],SHOW_SHORT_URL:["show short URL"],INCLUDE_CONTENT_MARKED_AS:["Include content marked as:"],PS_ITEMS_NOT_PUBLIC:["Some of the items in your photostream aren't public."],HERE_IS_PS_LINK:["Here's a link to this photostream. Just copy and paste!"],YOU_CAN_ADD_GUEST_PASS:['You can add a Guest Pass [<a class="guest-pass-link" title="',"${title}",'" data-action="follow" href="/help/sharing/#2184">?</a>] so that recipients can view them.'],ADD_A_GUEST_PASS:["Add a guest pass"],GUEST_PASS_COPY:["Guest Passes let you share your photos that aren't public. Anyone can see your public photos anytime, whether they're a Flickr member or not. But! If you want to share photos marked as friends, family or private, use a Guest Pass. If you're sharing photos from a set, you can create a Guest Pass that includes any of your photos marked as friends, family, or private. If you're sharing your entire photostream, you can create a Guest Pass that includes photos marked as friends or family (but not your private photos)."],VISIT_GUESTPASS_HISTORY:['You can visit your <a href="/invite/history/guests/" data-action="follow">Guest Pass history</a> at any time to expire the Guest Pass.'],SOMETHING_WRONG:["Something went wrong.<br>Please refresh your browser and try again."],ERROR:["Error"],OK:["OK"],SHARE_GROUP:["Share Group"],MESSAGE:["Message"],EMAIL:["Email"],SIGN_IN_TO_EMAIL:["You must be signed in to share a photo. Sign in and try again."],LINK_ACCOUNT:["Link Account"],ACCOUNT_SETTINGS:["Account Settings"],AUTHORIZE_FLICKR:["Authorize Flickr to use your account in the Account Settings page."],COPY_TO_CLIPBOARD:["Press Ctrl+C (Win) or Command+C (Mac) to copy this link when selected"],HTML_EMBED:["HTML Embed"],EMAIL_BODY_PHOTOS:["${username}"," shared ",{type:"plural",valueName:"count",options:{one:"${#} photos",other:"${#} photo"}}," with you!"],EMAIL_BODY_ALBUM:["${username}"," shared an album with you!"],EMAIL_BODY_PHOTOSTREAM:["${username}"," shared their photostream with you!"],SHARE_PHOTOS_TO:[{type:"plural",valueName:"count",options:{one:"Share ${#} photo to:",other:"Share ${#} photos to:"}}],SHARE_VIDEO_TO:[{type:"plural",valueName:"count",options:{one:"Share ${#} video to:",other:"Share ${#} videos to:"}}],SHARE_PHOTOSTREAM_TO:["Share photostream to:"],SHARE_ALBUM_TO:["Share album to:"],SHARE_GALLERY_TO:["Share gallery to:"],SHARE_FAVES_TO:["Share favorites to:"],SHARE_ALBUMS_TO:["Share albums to:"],SHARE_GROUP_TO:["Share group to:"],FACEBOOK:["Facebook"],TUMBLR:["Tumblr"],TWITTER:["Twitter"],PINTEREST:["Pinterest"],MAIL:["Mail"],EMBED:["HTML embed"],EMBED_SIMPLE:["Embed"],HTML:["HTML"],GRAB_LINK:["Grab link"],BBCODE:["BBCode"],VIA_FLICKR:["Via Flickr:"],SHARE_PUBLIC_ONLY:["Public photos only"],SHARE_FRIENDS:["Include photos marked Friends"],SHARE_FAMILY:["Include photos marked Family"],SHARE_FAMILY_AND_FRIENDS:["Include photos marked Family & Friends"],SHARE_FRIENDS_AND_FAMILY:["Include photos marked Friends & Family"],SHARE_PRIVATE:["All photos - public and private"],SHARING_DISABLED:["Sharing is disabled"],ON_FLICKR:["on Flickr"],PHOTO_PRIVATE_MESSAGE:['This photo is private. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FRIENDS_MESSAGE:['This photo is only visible to friends. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FAMILY_MESSAGE:['This photo is only visible to family. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FAMILY_FRIENDS_MESSAGE:['This photo is only visible to friends & family. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_CAMERAROLL_MESSAGE:["All photos being shared will be viewable by the recipient(s) regardless of privacy level."],GUESTPASS_CREATION_FAILURE:["There was an error generating the share link.  Please try again."],CONTACT_SEARCH_ERROR:["There was an error when adding a recipient. Please try again."],FLICKR_SHARE_ERROR:["There was an error sharing on Flickr. Please try again."],FLICKR_SHARE_SUCCESS:["Your items have been shared!"],FLICKR_SHARE_SUCCESS_TITLE:["Success"],CLICK_GENERATE_LINK:["Click to generate a shareable link"],FLICKR_SHARE:["Share"],COPY_MAC:["Press Command+C to copy this link when selected"],COPY_PC:["Press Ctrl+C to copy this link when selected"],CANCEL_SHARE_BECAUSE_ERROR:[{type:"plural",valueName:"photoCount",options:{one:"This photo cannot be shared. Please try again later.",other:"These photos cannot be shared. Please try again later."}}],LINK_PRIVACY_REMINDER:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in this selection will remain private. Only people you share this link with will be able to view it.",other:"The private photos in this selection will remain private. Only people you share this link with will be able to view them."}}],PHOTO_PAGE_PRIVACY_WARNING:["This photo will remain private. Only people you share this link with will be able to view it."],CAMERAROLL_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"This photo will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in this selection will remain private. Only people you share this link with will be able to view them."}}],ALBUM_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in this album will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in this album will remain private. Only people you share this link with will be able to view them."}}],PHOTOSTREAM_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in your photostream will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in your photostream will remain private. Only people you share this link with will be able to view them."}}],CANCEL_SHARE_BECAUSE_RESTRICTED:["Sorry! You can't share restricted photos."],NO_SHAREABLE_ITEMS:["There are no items available to share."],EMBEDR_OPTION_HEADER:["Header"],EMBEDR_OPTION_FOOTER:["Footer"],EMBEDR_OPTION_TRUNCATE:["Truncate"],EMBEDR_OPTION_SLIDESHOW:["Slideshow"],EMBEDR_CHANGE_PRIVACY_WARNING:['You\'re trying to embed one of your private photos! If you still want to embed this photo, you can make it public by selecting "Public" from the privacy menu at the bottom this page.'],ALBUM_DOWNLOAD_ACCESS_YOU:[{type:"plural",valueName:"photoCount",options:{one:"Only you will be able to download this photo.",other:"Only you will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_FF:[{type:"plural",valueName:"photoCount",options:{one:"Only your friends and family will be able to download this photo.",other:"Only your friends and family will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_FOLLOWING:[{type:"plural",valueName:"photoCount",options:{one:"Only people you follow will be able to download this photo.",other:"Only people you follow will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_MEMBERS:[{type:"plural",valueName:"photoCount",options:{one:"Only Flickr members will be able to download this photo.",other:"Only Flickr members will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_EVERYONE:[{type:"plural",valueName:"photoCount",options:{one:"Everyone will be able to download this photo.",other:"Everyone will be able to download these photos."}}],CHANGE_DOWNLOAD_PREF:["(<a href='","${url}","'>Change your download preferences</a>)"],EMBED_WITH_GUESTPASS:["Embed this photo with a guestpass"]})},"@VERSION@",{requires:["intl"]});YUI.add("signin-helper",function(e){function n(n,o){e.FlickrStorage.store(n,o)}function o(n,o){var i,t;o&&o.withPopup?(i=e.config.win.open(r(o),"_blank","height=650,resizable=1,scrollbars=1,location=yes"),t=setInterval(function(){i.closed&&(clearInterval(t),window.location.reload())},1e3)):e.config.win.location=r(o)}function r(n){(n=n||{}).closeWhenDone&&(n.postLoginUrl=e.url("/photo_grease_postlogin.gne",{protocol:!1}));var o=n.postLoginUrl||e.config.win.location.href;return(n.url||e.url("/signin/",{protocol:!1}))+"?redir="+encodeURIComponent(o)}function i(n,o){var r=(o=o||{}).postLoginUrl||e.config.win.location.href,i=o.url||e.url("/signup/",{protocol:!1});e.config.win.location=i+"?redir="+encodeURIComponent(r)}e.FlickrStorage={_storageKey:"flickrStorage",store:function(n,o){try{var r=[];e.StorageHelper.hasEntries(this._storageKey)&&(r=this.retrieve()),r.push({key:n,value:o}),e.StorageHelper.setItem(this._storageKey,JSON.stringify(r))}catch(e){}},retrieve:function(){var n={};try{n=JSON.parse(e.StorageHelper.getItem(this._storageKey))}catch(e){}return n},remove:function(){try{e.StorageHelper.remove(this._storageKey)}catch(e){}},hasEntries:function(){return e.StorageHelper.hasEntries(this._storageKey)}},e.SigninHelper={savePreLoginAction:n,addPendingFave:function(e,r){n("fave",e),o(0,r)},addPendingComment:function(e,n){o(0,n)},addPendingShare:function(e,r){n("share",e),o(0,r)},addPendingFollow:function(e,r){n("follow",e),o(0,r)},addPendingJoinGroup:function(e,r){n("joingroup",e),o(0,r)},addPendingDownload:function(e,r){n("download",e),o(0,r)},checkPendingQueue:function(n){var o,r,i=[];if(n){if(e.FlickrStorage.hasEntries()){o=e.FlickrStorage.retrieve();for(r in o)(function(e,n){var o=n.key,r=n.value;switch(o){case"fave":return(function(e,n){var o=n.id;e.getModelRegistry("photo-engagement-models").then(function(e){var n=e.proxy(o);n.registry.addAsFave(o)&&n.remoteUpdate()})})(e,r),!0;case"share":return!1}})(n,o[r])||i.push(o[r])}return e.FlickrStorage.remove(),i}},_redirectToSignin:o,_redirectToSignUp:i,_getSigninUrl:r,signUpPendingFave:function(e,o){n("fave",e),i(0,o)},signUpPendingComment:function(e,n){i(0,n)},signUpPendingFollow:function(e,o){n("follow",e),i(0,o)},signUpPendingJoinGroup:function(e,o){n("joingroup",e),i(0,o)},signUpPendingDownload:function(e,o){n("download",e),i(0,o)}}},"@VERSION@",{requires:["url","storage-helper"]});YUI.add("fluid-share-view",function(e,r){var t=require("hermes-core/flog")(r),a={shareRedirectURL:e.url("/window_close.html"),css:{shareBtn:"fluid-share-button",networkClasses:{twitter:{canShare:!1,className:"twitter-link",serviceId:9},facebook:{canShare:!1,className:"facebook-link",serviceId:128},tumblr:{canShare:!1,className:"tumblr-link",serviceId:12},pinterest:{canShare:!1,className:"pinterest-link",serviceId:132},flickr:{canShare:!1,className:"flickr-link",serviceId:130}}}};a.networks={facebook:{clientId:e.config.flickr.facebook.client_id,shareUrl:"https://www.facebook.com/dialog/share?app_id="+e.config.flickr.facebook.client_id+"&display=popup&redirect_uri="+encodeURIComponent(a.shareRedirectURL)+"&href="},twitter:{shareUrl:"https://twitter.com/intent/tweet?text={{tweetText}}&url={{linkToShare}}",hashTags:"#flickr"},tumblr:{shareUrl:"https://www.tumblr.com/widgets/share/tool?caption={{tumblrCaption}}&tags={{tags}}&url={{linkToShare}}"},pinterest:{shareUrl:"https://pinterest.com/pin/create/bookmarklet/?media={{displayPhotoURL}}&url={{linkToShare}}&description={{description}}"},googlePlus:{shareUrl:"https://plus.google.com/share?url="},flickr:{apiCall:"flickr.sharing.post"}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.extraModalClasses=this.extraModalClasses||"","en-us"===this.appContext.lang.toLowerCase()?this.isEnglishLang=!0:this.isEnglishLang=!1,this.removeOverlayOnClose=e.removeOverlayOnClose,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(e){return e=e||{},this.setContainerWithTemplate("fluid-share",e),this},activate:function(){var r=this.get("container"),t="."+a.css.shareBtn,i=r.one(t);return!i||!this.isEnglish&&this.isDisabled||this.registerEventHandler(r.delegate(["click","keydown"],function(r){"click"!==r.type&&13!==r.keyCode||(r.preventDefault(),e.rapidTracker.beacon(this.subClassName,"shareButtonClick"),this.getItemCount().then(function(r){e.rapidTracker.beacon(this.subClassName,"shareButtonClickCount",{count:r})}.bind(this)),this.prepareModal(i))},t,this)),this},prepareModal:function(r){if(!this.shouldCancelModal())return this.getItemCount().then(function(t){return this.isDisabled?e.Promise.resolve(this.showErrorModal()):e.Promise.resolve(this.showModal(r,t,this.removeOverlayOnClose))}.bind(this)).catch(function(e){t.error({err:e})})},showModal:function(r,t,i){var s,n=this,o=this.getIsMine(),l=a.css.networkClasses,c=n.getTitleIntlKey(),h={intlName:"share-modal."+c};return"SHARE_PHOTOS_TO"!==c&&"SHARE_VIDEO_TO"!==c||(h.count=t),(s=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,noScroll:!0,hideModalOverlay:!1,maxHeight:!1,showFooter:!1,title:n.intlMessage(h),classList:"modal-restyle "+n.extraModalClasses,width:560,subview:new e.Views["fluid-share-panel-view"]({appContext:n.appContext,networkClasses:l,linkShareParams:this.prepareLinkShareParameters(),guestPassParams:this.getGuestPassParams(),emailShareParams:this.prepareFlickrShareParameters(),isMine:o,shareItemCount:t,signedOutSharingPerms:this.getSignedOutSharingPerms(),canVr:this.get("canVr")}),removeOverlayOnClose:i})).registerEventHandler(s.get("container").delegate(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode||(e.preventDefault(),e.target.ancestor("."+l.facebook.className,!0)?n.preProcessShare(n.prepareFacebookShareParameters,n.shareToFacebook):e.target.ancestor("."+l.twitter.className,!0)?n.preProcessShare(n.prepareTwitterShareParameters,n.shareToTwitter):e.target.ancestor("."+l.tumblr.className,!0)?n.preProcessShare(n.prepareTumblrShareParameters,n.shareToTumblr):e.target.ancestor("."+l.pinterest.className,!0)&&n.preProcessShare(n.preparePinterestShareParameters,n.shareToPinterest))},".share-link.sharing-type-enabled")),s.on("share-by-email",function(r){var t=e.merge(n.prepareFlickrShareParameters(),r);n.shareToFlickr(s,t)}),s.on("done-sharing",function(r){s.close(),n.guestPassURLs={},e.rapidTracker.beacon(this.subClassName,"doneSharingClick")}),s.on("request-guestpass",function(e,r,t){n.requestGuestpass(s,r,t,!0)}),s.on("generate-link",function(){n.generateLink().then(function(e){s.fire("parentViewEvent","generated-link",e)})}),s.on("activated",function(){s.get("subview").cancel&&s.get("container").one(".title").setHTML(n.intlMessage({intlName:"common.OOPS"})),s.reposition()}),s.on("guestpass-required",function(){n.guestpassRequired=!0}),s.on("confirm-sign-in",function(){s.close();var r=new e.Views.FluidModal({appContext:n.appContext,title:n.intlMessage({intlName:"common.OOPS"}),message:n.intlMessage({intlName:"share-modal.SIGN_IN_TO_EMAIL"}),actionButtonLabel:n.intlMessage({intlName:"common.OK"}),classList:"sharing-sign-out-modal",showCancelButton:!0});r.on("actionClick",function(){e.StorageHelper.setItem("signedOutEmailSharing",new Date),e.SigninHelper.addPendingShare({shareType:"email"})}),setTimeout(function(){r.show()},10)}),s.on("close",function(){n.fire("sharePresentationClose"),n.guestPassURLs={},e.rapidTracker.beacon(n.name,"shareModalCancelClick")}),s.on("closeAll",function(){n.fire("sharePresentationClose"),s.close(),n.guestPassURLs={}}),s.show(),this.sharePresentation=s,s},showErrorModal:function(){var r=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showCancelButton:!1,noScroll:!0,hideModalOverlay:!1,showFooter:!0,title:this.intlMessage({intlName:"common.OOPS"}),message:this.intlMessage({intlName:"share-modal.NO_SHAREABLE_ITEMS"})});return r.show(),r},prepareFacebookShareParameters:function(){return{url:"",count:1}},prepareTwitterShareParameters:function(){return{shortURL:"",url:"",title:"",count:1}},prepareTumblrShareParameters:function(){return{title:"",authorURL:"",ownerName:"",description:"",displayPhotoURL:"",url:"",count:1}},preparePinterestShareParameters:function(){return{title:"",description:"",displayPhotoURL:"",shortURL:"",url:"",count:1}},prepareGooglePlusShareParameters:function(){return{url:"",count:1}},prepareFlickrShareParameters:function(){return{modelName:"",modelId:"",title:"",url:"",count:1}},prepareLinkShareParameters:function(){return{sizes:{},url:"",title:"",author:"",authorURL:"",shortURL:"",supportsEmbedr:!1,supportsBBCode:!1,privacyWarningString:"",generateLink:!1}},getTitleIntlKey:function(){return"SHARE_PHOTOS_TO"},getItemCount:function(){return e.Promise.resolve(1)},getIsMine:function(){return!1},getGuestPassParams:function(){return{type:null,id:null,contentMarkedFriends:!0,contentMarkedFamily:!0,contentMarkedFriendFamily:!0,contentMarkedPublic:!0,canSharePrivate:!1,sharingEntirelyNotPublic:!1,multipleItems:!1,nonPublicWarning:null,shareToAll:!1,showGuestPassDropdown:!1,shareToSpecific:null}},getSignedOutSharingPerms:function(){return{facebook:{canShare:!0},twitter:{canShare:!0},tumblr:{canShare:!0},pinterest:{canShare:!0},flickr:{canShare:!1}}},shouldCancelModal:function(){return!1},shareToFacebook:function(r,i){if(!r.url)return t.error("Error sharing to Facebook.  Missing url.");var s,n,o,l,c,h=encodeURIComponent(e.url(r.url)),u=this.guestPassURLs;this.guestpassRequired&&u&&(n=u[100],o=u["010"],l=u[110],c=u[111],o&&(h=o),n&&(h=n),l&&(h=l),c&&(h=c)),s=a.networks.facebook.shareUrl+h,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"facebook",count:r.count||1}),i?i.location.replace(s):i=this.createSharePopup(s),this.trackShareCompletion(i)},shareToTwitter:function(r,i){if(void 0===r.url||null===r.url)return t.error("Error sharing to Twitter.  Missing url.");if(!r.title)return t.error("Error sharing to Twitter.  Missing title.");var s,n,o,l,c=r.title;n=""===r.url?"":encodeURIComponent(r.url),(l=c+" "+a.networks.twitter.hashTags).length+n.length>140&&(o=l.length+n.length-140,l=c.substring(0,c.length-(o+1))+"… "+a.networks.twitter.hashTags),s=a.networks.twitter.shareUrl.replace("{{tweetText}}",encodeURIComponent(l)).replace("{{linkToShare}}",n),i?i.location.replace(s):i=this.createSharePopup(s),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"twitter",count:r.count||1}),this.trackShareCompletion(i)},shareToTumblr:function(r,i){if(!r.title)return t.error("Error sharing to Tumblr.  Missing title.");if(!r.displayPhotoURL)return t.error("Error sharing to Tumblr.  Missing displayPhotoURL.");var s,n,o,l,c,h=r.title,u=r.tags||"",p=r.description,d=e.URLHelper.addProtocolToURL(r.displayPhotoURL),g=r.isPhotoPage,m=a.networks.tumblr.shareUrl;g&&this.appContext.flipper.isFlipped("enable-tumblr-embed-share")||(m+="&shareSource=legacy&posttype=photo&content={{displayPhotoURL}}&clickthroughUrl={{linkToShare}}"),r.authorURL&&(n=e.url(r.authorURL)),r.ownerName&&(o=r.ownerName),l=0===r.url.indexOf("https://")?r.url:0===r.url.indexOf("//")?e.URLHelper.addProtocolToURL(r.url):e.url(r.url),s=this.templates("fluid-share-tumblr-post")({title:h,ownerURL:n,ownerName:o,description:p,linkToShare:l}),c=m.replace("{{displayPhotoURL}}",encodeURIComponent(d)).replace("{{tumblrCaption}}",encodeURIComponent(s)).replace(/{{linkToShare}}/g,encodeURIComponent(l)).replace("{{tags}}",encodeURIComponent(u)),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"tumblr",count:r.count||1}),i?i.location.replace(c):i=this.createSharePopup(c,!0)},shareToPinterest:function(r,i){if(!r.title)return t.error("Error sharing to Pinterest.  Missing title.");if(!r.displayPhotoURL)return t.error("Error sharing to Pinterest.  Missing displayPhotoURL.");if(!r.url)return t.error("Error sharing to Pinterest.  Missing url.");if(!r.shortURL)return t.error("Error sharing to Pinterest.  Missing shortURL.");var s,n,o,l=e.Handlebars.helpers.stripTags(r.description)||"",c=r.shortURL,h=r.title,u=e.URLHelper.addProtocolToURL(r.displayPhotoURL);n=encodeURIComponent(e.url(r.url)),o=""!==l.trim()?c+" | "+h+" | "+l:c+" | "+h,u=u.replace("https:","http:"),n=n.replace("https:","http:"),s=a.networks.pinterest.shareUrl.replace("{{displayPhotoURL}}",encodeURIComponent(u)).replace("{{description}}",encodeURIComponent(o)).replace("{{linkToShare}}",n),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"pinterest",count:r.count||1}),i?i.location.replace(s):i=this.createSharePopup(s,!0)},shareToGooglePlus:function(r,i){if(!r.url)return t.error("Error sharing to GooglePlus.  Missing url.");var s,n;n=encodeURIComponent(e.url(r.url)),s=a.networks.googlePlus.shareUrl+n,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"googlePlus",count:r.count||1}),i?i.location.replace(s):i=this.createSharePopup(s)},shareToFlickr:function(r,i){if(!i.recipients)return t.error("Error sharing to Flickr.  Missing recipients.");if(!i.url)return t.error("Error sharing to Flickr.  Missing url.");if(!i.modelName)return t.error("Error sharing to Flickr.  Missing modelName.");if(!i.modelId)return t.error("Error sharing to Flickr.  Missing modelId.");var s,n,o=i.modelName,l=i.modelId,c=i.recipients,h=i.message||"",u=i.guestpassStr||"public",p={},d=[],g=[];encodeURIComponent(e.url(i.url)),"share_code"===o?p[o]=l:p[o+"_id"]=l,p.service_type_id="130",p.owner_id=this.appContext.getViewer().nsid,"public"!==u&&("friends"!==u&&"family_and_friends"!==u||(p.guestpass_friends="1"),"family"!==u&&"family_and_friends"!==u||(p.guestpass_family="1"),"private"===u&&(p.guestpass_private="1",p.guestpass_friends="1",p.guestpass_family="1"));for(s in c)(n=c[s]||{}).email?d.push(n.email):n.nsid&&g.push(n.nsid);p.to_flickr=g.join(","),p.to_email=d.join(","),p.message=e.flutil.escapeInput(h),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"flickr",count:i.count||1,flkcnt:g.length,emailcnt:d.length});var m=e.StorageHelper.getItem("signedOutEmailSharing");if(m){var f;try{(f=e.moment(m)).isValid()&&(new e.moment).diff(f,"hours")<2&&(e.rapidTracker.beacon(this.get("parentViewName"),"signedOutEmailShare",{count:i.count||1}),e.StorageHelper.remove("signedOutEmailSharing"))}catch(e){}}if(!a.networks)throw new Error("Missing sharing api configuration.");this.appContext.callAPI(a.networks.flickr.apiCall,p).then(function(){r&&r.fire("parentViewEvent","flickr-share-success")},function(e){r&&r.fire("parentViewEvent","flickr-share-error")})},generateLink:function(){var r=this;return this.onBeforeShare().then(function(e){return e},function(t){r.sharePresentation.fire("closeAll"),setTimeout(function(){new e.Views.FluidModal({appContext:r.appContext,title:r.intlMessage({intlName:"common.OOPS"}),message:r.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_ERROR",photoCount:r.getGuestPassParams.multipleItems?10:1}),actionButtonLabel:r.intlMessage({intlName:"common.OK"}),classList:"sharing-failure-modal",showCancelButton:!1}).show()},10)})},preProcessShare:function(e,r){var a=this;if(this.onBeforeShare){var i=this.createSharePopup("",!0);try{i.document.body.innerHTML=a.templates("fluid-share-loading-state")()}catch(e){18===e.code&&(i.close(),(i=this.createSharePopup("",!0)).document.body.innerHTML=a.templates("fluid-share-loading-state")())}this.onBeforeShare().then(function(s){var n;try{n=e.call(a)}catch(e){t.error("Error getting share parameters",{err:e})}r.call(a,n,i)})}else{var s;try{s=e.call(a)}catch(e){t.error("Error getting share parameters",{err:e})}r.call(a,s)}},trackShareCompletion:function(r){var a=function(i){if(i.source===r)if(i.origin===e.url("/")&&"Window closed"===i.data)t.log("Closing Facebook window."),e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToFacebook"),e.config.win.removeEventListener("message",a,!1);else if(i.origin===e.url("/")&&0===i.data.indexOf("share failure"))t.error("Got Facebook error",{data:i.data}),e.config.win.removeEventListener("message",a,!1);else if("https://twitter.com"===i.origin&&"__ready__"!==i.data)try{t.log("Tracking share completion",{data:i.data}),"tweet"===JSON.parse(i.data).params[0]&&i.returnValue&&(e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToTwitter"),e.config.win.removeEventListener("message",a,!1))}catch(e){t.error("Error tracking share completion",{err:e})}};e.config.win.addEventListener("message",a,!1)},createSharePopup:function(r,t){var a={},i="",s="nativeShare"+(new Date).getTime();return a.width=t?950:640,a.height=480,a.top=(e.config.win.screen.height-a.height)/2,a.left=(e.config.win.screen.width-a.width)/2,e.Object.each(a,function(e,r){i+=r+"="+e+","}),i=i.slice(0,-1),e.config.win.open(r,s,i)},requestGuestpass:function(e,r,t,a){var i=this;this.guestPassURLs||(this.guestPassURLs={}),this.guestPassURLs[r]?e.fire("parentViewEvent","guestpass-created",r,this.guestPassURLs[r]):this.appContext.callAPI("flickr.sharing.createGuestpass",t).then(function(t){if(!t||!t.guestpass||!t.guestpass.url)throw new Error("No guestpass returned");i.guestPassURLs[r]=t.guestpass.url,e.fire("parentViewEvent","guestpass-created",r,i.guestPassURLs[r])},function(s){a?i.requestGuestpass(e,r,t):e.fire("parentViewEvent","guestpass-failed",s)})}},{ATTRS:{parentViewName:{value:""}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-fluid-share","hermes-template-fluid-share-tumblr-post","hermes-template-fluid-share-loading-state","fluid-share-panel-view","url","flutil","url-helper","signin-helper","handlebars-helpers"],optionalRequires:["fluid"],langBundles:["share-modal","common"]});YUI.add("fluid-share-album-view",function(e,t){var a=require("hermes-core/flog")(t);e.namespace("Views").FluidShareAlbumView=e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){return this.albumId=e.albumId,this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-album-icon",sharingDisabled:!0,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_ALBUM"})}),this.constructor.superclass.initializer.call(this,e)},loadState:function(){return e.Promise.resolve()},getItemCount:function(){return this.loadRequiredModels()},loadRequiredModels:function(){var t=this;return e.Promise.all([this.appContext.getModel("set-models",this.albumId+"-1",{filter:1,perPage:5,page:1}),this.appContext.getModel("album-privacy-models",this.albumId),this.appContext.getModel("set-models",this.albumId)]).then(function(e){t.set("albumModel",e[0]),t.set("privacyModel",e[1]),t.isDisabled=0===e[0].getValue("canShare"),t.set("photos",e[0].getValue("photoPageList").getList()),t.set("fullAlbum",e[2]),e[2].on("valuesChanged",function(e){var a={};e&&(Object.keys(e).forEach(function(l){var r=e[l];r.id===t.albumId&&(a[l]=r.newVal)}),Object.keys(a).length>0&&t.get("albumModel").setValues(a))})},function(e){a.error("failed to get models",{err:e})})},buildContainer:function(){return this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-album-icon",sharingDisabled:this.isDisabled,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_ALBUM"})}),this},prepareFacebookShareParameters:function(){return{url:this.get("albumModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("fullAlbum");return{url:e.URLHelper.getShortAlbumURL(t.getValue("normalizedId")),title:t.getValue("title")}},prepareTumblrShareParameters:function(){var e=this.get("fullAlbum");return{title:e.getValue("title"),authorURL:e.getValue("owner").getValue("url"),ownerName:e.getValue("owner").getValue("displayname"),description:e.getValue("description"),displayPhotoURL:this.get("photos").map(function(e){return e.getLargestSize().url}),url:e.getValue("url"),tags:"Flickr"}},preparePinterestShareParameters:function(){var t=this.get("fullAlbum");return{title:t.getValue("title"),description:t.getValue("description"),displayPhotoURL:this.get("photos").length>0?this.get("photos")[0].getLargestSize().url:null,shortURL:e.URLHelper.getShortAlbumURL(t.getValue("normalizedId")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("fullAlbum");return{modelName:"set",modelId:this.albumId,modelOwnerId:e.getValue("owner").id,title:e.getValue("title"),url:e.getValue("url"),count:1}},prepareLinkShareParameters:function(){var t,a,l,r=this.get("albumModel"),i=this.get("fullAlbum"),s=!1;if(t=this.intlMessage({intlName:"share-modal.ALBUM_PRIVACY_WARNING",photoCount:i.getValue("totalCount")}),this.appContext.flipper.isFlipped("enable-album-download")&&i.getValue("owner").getValue("isMe")){switch(s=!0,this.appContext.getViewer().prefs.downloadAccessPref){case 4:l="ALBUM_DOWNLOAD_ACCESS_YOU";break;case 3:l="ALBUM_DOWNLOAD_ACCESS_FF";break;case 2:l="ALBUM_DOWNLOAD_ACCESS_FOLLOWING";break;case 1:l="ALBUM_DOWNLOAD_ACCESS_MEMBERS";break;case 0:l="ALBUM_DOWNLOAD_ACCESS_EVERYONE"}l&&(a=this.intlMessage({intlName:"share-modal."+l,photoCount:i.getValue("totalCount")}))}return{sizes:r.getValue("primaryPhotoSizes"),url:i.getValue("url"),title:i.getValue("title"),author:i.getValue("owner").getValue("displayname"),authorURL:i.getValue("owner").getValue("url"),albumId:r.getValue("normalizedId"),shortURL:e.URLHelper.getShortAlbumURL(i.getValue("normalizedId")||i.getValue("id")),supportsEmbedr:2===i.getValue("canShare")&&this.appContext.flipper.isFlipped("enable-embedr-in-share")&&this.appContext.flipper.isFlipped("enable-embedr-in-albums"),supportsBBCode:!1,privacyWarningString:t,showDownloadWarning:s,downloadAccessString:a}},getTitleIntlKey:function(){return"SHARE_ALBUM_TO"},getGuestPassParams:function(){var e=this.get("privacyModel"),t=this.get("fullAlbum").getValue("owner").getValue("isMe"),a=e.getValue("countPhotosPublic"),l=e.getValue("countPhotosFriendFamily"),r=e.getValue("countPhotosFriend"),i=e.getValue("countPhotosFamily"),s=this.get("privacyModel").getValue("totalCount")-a,u=t&&l>0&&l!==a,o=t&&r>0&&r!==a,n=t&&i>0&&i!==a,d=!1;return u&&r===l&&(o=!1),u&&i===l&&(n=!1),(s>0||u||n||o)&&(d=!0),{type:"set",id:this.get("albumModel").getValue("normalizedId"),contentMarkedFriends:o,contentMarkedFamily:n,contentMarkedFriendFamily:u,contentMarkedPublic:a,canSharePrivate:d&&t,showGuestPassDropdown:t&&a!==this.get("fullAlbum").getValue("totalCount"),multipleItems:!0}},getIsMine:function(){return this.get("albumModel").getValue("isOwner")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper"],langBundles:[]});YUI.add("album-engagement-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.doOffline=!!this.appContext.flipper.isFlipped("enable-offline-downloadr"),this},subviewConfig:{"fluid-share-album-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,parentViewName:this.name}},loadState:function(){var e=this;return e.appContext.getModel("set-models",e.albumId).then(function(t){e.set("albumModel",t)})},createBookFromAlbum:function(){var t=this;this.appContext.flipper.isFlipped("enable-blurb-photobooks-links")?this.appContext.flapp.navigate("/create"):t.appContext.getModelRegistry("book-models").then(function(i){return i.remoteCreate({photoset_id:t.albumId}).then(function(i){e.rapidTracker.beacon(t.name,"photobookFromAlbum"),t.appContext.flapp.navigate("/create/books/"+i.id+"/cover")})},function(e){t.onError(t.intlMessage({intlName:"album-page.ERROR_CREATING_PHOTOBOOK_FROM_ALBUM"}))})},buildContainer:function(){var e=this.get("container"),t=this.get("albumModel"),i=!1,o={};return"justified"===this.albumPhotoListLayoutStyle&&e.addClass("justified"),this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===t.getValue("owner").id&&(i=!0),o.viewerIsOwner=i,o.enableDownload=!1,(this.appContext.flipper.isFlipped("enable-just-your-album-download")&&i||this.appContext.flipper.isFlipped("enable-album-download")&&t.getValue("canDownload"))&&(o.enableDownload=!0),this.subviews["fluid-share-album-view"]&&(o["fluid-share-album-view"]=this.subviews["fluid-share-album-view"].get("container"),(o.viewerIsOwner||o["enable-download"])&&o["fluid-share-album-view"].addClass("not-alone")),this.setContainerWithTemplate("album-engagement",o),this},buildErrorContainer:function(){},activate:function(){var t=this,i=this.get("container"),o=i.one(".create-book-container"),n=i.one(".download-album-container");return o&&t.registerEventHandler(o.on("click",function(){t.createBookFromAlbum()})),n&&(this.bulkDownloaderView=new e.BulkDownloaderView({appContext:this.appContext,doOffline:this.doOffline}),t.registerEventHandler(n.on("click",t.downloadAlbum.bind(this)))),this},destructor:function(){this.bulkDownloaderView&&this.bulkDownloaderView.destroy()},downloadAlbum:function(t){var i,o,n=this,a=this.get("albumModel");if(e.rapidTracker.beacon(this.name,"openDownloadAlbum"),this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===a.getValue("owner").id&&this.bulkDownloaderView.set("isOwnAlbum",!0),this.doOffline){if(1===a.getValue("totalCount"))return a.getValue("photoPageList").getPage({page:1,perPage:1}).then(function(t){var i,o,n,a=t[0];a.getValue("isVideo")?o="/video_download.gne?id="+a.id:(i=(n=a.getLargestSize({excludeSizes:[]}).url.split(".")).pop(),o="https:"+n.join(".")+"_d."+i),e.config.doc.location.href=o});if(a.getValue("totalCount")>e.config.flickr.downloadr.max_album_items)return e.rapidTracker.beacon(this.name,"albumDownloadTooMany"),this.onError(this.intlMessage({intlName:this.bulkDownloaderView.get("isOwnAlbum")?"downloadr.ALBUM_TOO_MANY_OWN":"downloadr.ALBUM_TOO_MANY_OTHER",username:a.getValue("owner").getValue("displayname"),userurl:a.getValue("owner").getValue("url"),url:"/photos/organize?start_tab=one_set"+a.id}),this.intlMessage({intlName:"downloadr.TOO_MANY_TITLE"}),!0);i=n.bulkDownloaderView.createTitle(a.getValue("photoCount"),a.getValue("videoCount")),n.bulkDownloaderView.showDownloadDialog({doOffline:!0,title:i,setID:this.albumId})}else o=this.bulkDownloaderView.showLoadingDialog(),this.bulkDownloaderView.prepareArchive({set_id:this.albumId}).then(function(e){o.close(),n.bulkDownloaderView.showDownloadDialog(e)}).catch(function(e){o.close(),n.onError(e)})},onParentViewEvent:function(e,t){var i=this.get("container");return"album-engagement-view"===e&&"albumHeaderView:editing"===t[0]?(i.addClass("invisible"),!1):"album-engagement-view"===e&&"albumHeaderView:doneEditing"===t[0]?(i.removeClass("invisible"),!1):void 0},onError:function(t,i,o){var n;return n={appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),darkOverlay:!0},n[o?"htmlMessage":"message"]=t,this.errorDialog=new e.Views.FluidModal(n),this.errorDialog.show(),this.errorDialog}})},"@VERSION@",{requires:["flickr-view","hermes-template-album-engagement","hermes-template-flickr-balls"],optionalRequires:["bulk-downloader-view"],optional:["fluid-share-album-view"],langBundles:["common","album-page","downloadr"]});YUI.add("hermes-lang-downloadr",function(e,a){e.Intl.add("hermes/downloadr","en-US",{DOWNLOAD_WHEN_READY:["We'll zip up these items and send you a FlickrMail with a link to download them when they are ready."],DOWNLOAD_WHEN_READY_LOGGED_OUT:["We'll zip up these items and give you a link to download them when they are ready."],BE_SURE_RIGHTS:["These items belong to another Flickr member and they own the copyright. Be sure you respect the license on each of these items."],CREATE_ZIP:["Create zip file"],CREATING_ZIP:["Creating your zip file...<br>keep this window open"],CREATING_ZIP_LOGGED_IN:["Creating your zip file...<br>"],HAVE_QUESTIONS:['Have questions? Visit the <a target="_blank" href="',"${url}",'">download help page</a> or the <a target="_blank" href="/forum">Flickr Help Forum</a>.<br>No worries, links open in a new window.'],PLEASE_WAIT:["Please wait"],DOWNLOADS_READY:[{type:"plural",valueName:"num",options:{one:"Your zip file of ${#} items is ready to download",other:"Your zip files of ${#} items are ready to download"}}],DOWNLOAD_ZIP_FILE:["Download zip file"],DOWNLOAD_ZIP_FILES:["Download zip file ",{type:"number",valueName:"num"}],POLLING_ERROR:["An error occured retrieving this download.  Please try again later."],FAILED:["Failed"],FAILED_DOWNLOAD:["Creating the zip file has failed.<br>Please try again later."],TOOLTIP_DOWNLOAD_LINK_MESSAGE:['A FlickrMail with your download link will appear here shortly or <a target="_blank" href="',"${url}",'">view the progress</a>.'],TOOLTIP_OK:["OK, thanks"],CAMERAROLL_TOO_MANY:["We can only process <b>up to 500 photos</b> from the Camera Roll at a time. Please select fewer photos and try again."],TOO_MANY_TITLE:["Whoa, that's a lot of photos!"],ALBUM_TOO_MANY_OWN:['We can only process albums with <b>fewer than 5,000 photos</b>. Please use <a target="_blank" href="/cameraroll">Camera Roll</a> or <a target="_blank" href="',"${url}",'">Organizr</a> to create smaller albums or to remove photos from this one, then try again.'],ALBUM_TOO_MANY_OTHER:['We can only process albums with <b>fewer than 5,000 photos</b>. Please ask <a target="_blank" href="',"${userurl}",'">',"${username}","</a> to create smaller albums or to remove photos from this one, then try again."]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-cameraroll",function(e,o){e.Intl.add("hermes/cameraroll","en-US",{CAMERA_ROLL:["Camera Roll"],PRIVACY_ERROR:["An error occurred while trying to change the Privacy of the photos. Please try again."],CIRCA:["Circa"],CIRCA_SOMETIME:["Circa / Sometime"],CIRCA_SOMETIME_YEAR:["Circa / Sometime in ","${year}"],CIRCA_YEAR:["Circa ","${year}"],SOMETIME_IN_MONTH:["Sometime in ",{type:"date",valueName:"date",format:"monthYear"}],DELETE_PHOTOS:[{type:"plural",valueName:"selectedCount",options:{one:"Delete ${#} photo?",other:"Delete ${#} photos?"}}],DELETE_MESSAGE:["You cannot reverse this action. ",{type:"plural",valueName:"selectedCount",options:{one:"Are you sure you want to permanently delete this photo?",other:"Are you sure you want to permanently delete all these photos?"}}],DELETE_ERROR:["An error has occurred deleting your selected photos. Please try again."],REMOVE_FROM_SELECTION:["Remove from selection"],EDIT_PHOTOS:[{type:"plural",valueName:"selectedCount",options:{one:"Editing ${#} photo",other:"Editing ${#} photos"}}],GO_TO_PHOTOPAGE:["Go to photo page"],CHANGE_PRIVACY_PHOTOS_PUBLIC:[{type:"plural",valueName:"count",options:{one:"Make ${#} photo public?",other:"Make ${#} photos public?"}}],CHANGE_PRIVACY_MESSAGE_PUBLIC:[{type:"plural",valueName:"count",options:{one:"Are you sure you want to make this photo public?",other:"Are you sure you want to make these photos public?"}}],CHANGE_PRIVACY_PHOTOS:[{type:"plural",valueName:"count",options:{one:"Change privacy of ${#} photo?",other:"Change privacy of ${#} photos?"}}],CHANGE_PRIVACY_MESSAGE:[{type:"plural",valueName:"count",options:{one:"Are you sure you want to change the privacy of this photo?",other:"Are you sure you want to change the privacy of these photos?"}}],ERROR_TITLE_PHOTOS:[{type:"plural",valueName:"count",options:{one:"Unable to update the Title/Description of one photo.",other:"Unable to update the Title/Description of ${#} photos."}}],ERROR_SAFETY_PHOTOS:[{type:"plural",valueName:"count",options:{one:"Unable to update the safety level of one photo.",other:"Unable to update the safety level of ${#} photos."}}],ERROR_LICENSE_PHOTOS:[{type:"plural",valueName:"count",options:{one:"Unable to update the license of one photo.",other:"Unable to update the license of ${#} photos."}}],ERROR_PERMISSIONS_PHOTOS:[{type:"plural",valueName:"count",options:{one:"Unable to update the permissions of one photo.",other:"Unable to update the permissions of ${#} photos."}}],ERROR_DATES_PHOTOS:[{type:"plural",valueName:"count",options:{one:"Unable to update the dates of one photo.",other:"Unable to update the dates of ${#} photos."}}],ERROR_TAGS_PHOTOS:[{type:"plural",valueName:"count",options:{one:"Unable to update the tags of one photo.",other:"Unable to update the tags of ${#} photos."}}],ERROR_PEOPLE_PHOTOS:[{type:"plural",valueName:"count",options:{one:"Unable to update the people in one photo.",other:"Unable to update the people in ${#} photos."}}],CONSOLIDATED_ERROR_MESSAGE:["The following errors occurred while processing your selected photos:"],MAX_TAGS_REACHED:["Maximum number of tags added."],MAX_PEOPLE_REACHED:["Maximum number of people added."],UNABLE_TO_ADD_USERS_TO_PHOTO:[{type:"plural",valueName:"count",options:{one:"${#} person could not be added to certain photos as they were either already present, or did not want to be identified in those photos.",other:"${#} people could not be added to certain photos as they were either already present, or did not want to be identified in those photos."}}],UNABLE_TO_ADD_TAGS_TO_PHOTOS:[{type:"plural",valueName:"count",options:{one:"Unable to add these tags to the photo as this would exceed the maximum number of tags possible on the photo.",other:"Unable to add these tags to ${#} photos as this would exceed the maximum number of tags possible on those photos."}}],UNABLE_TO_ADD_USERS_TO_ALL_PHOTOS:[{type:"plural",valueName:"count",options:{one:"${#} person could not be added to all the selected photos.",other:"${#} people could not be added to all the selected photos."}}],UNABLE_TO_ADD_PHOTOS_TO_ALL_USERS:[{type:"plural",valueName:"count",options:{one:"Unable to add people to one photo.",other:"Unable to add people to ${#} photos."}}],CONTACT_LIST_ERROR:["Unable to fetch your contact list."],DATE_POSTED_GREATER_THAN_FLICKR_JOIN:["Posted date must be after you joined Flickr."],DATE_UPLOADED_GREATER_THAN_FLICKR_JOIN:["Uploaded date must be after you joined Flickr."],TITLE_PLACEHOLDER:[{type:"plural",valueName:"selectedCount",options:{one:"Change title",other:"Change all titles"}}],DESCRIPTION_PLACEHOLDER:[{type:"plural",valueName:"selectedCount",options:{one:"Change description",other:"Change all descriptions"}}],EDIT_PRIVACY_LABEL:[{type:"plural",valueName:"selectedCount",options:{one:"Who can see this photo",other:"Who can see these photos"}}],EDIT_COMMENTING_PERMISSION_LABEL:[{type:"plural",valueName:"selectedCount",options:{one:"Who can comment on this photo",other:"Who can comment on these photos"}}],EDIT_TAGGING_PERMISSION_LABEL:[{type:"plural",valueName:"selectedCount",options:{one:"Who can add tags and people to this photo",other:"Who can add tags and people to these photos"}}],EDIT_SAFETY_LABEL:[{type:"plural",valueName:"selectedCount",options:{one:"How safe is this photo for public search",other:"How safe are these photos for public search"}}],EDIT_COPYRIGHT_LABEL:[{type:"plural",valueName:"selectedCount",options:{one:"Copyright protection level for this photo",other:"Copyright protection level for these photos"}}],UNKNOWN:["Unknown"],DELETE_ERROR_TITLE:["Oh no!"],DELETE_ERROR_PHOTO_MISSING:["We couldn’t delete all of these photos because it looks like some of them aren’t accessible anymore."],DELETE_ERROR_SIGNED_OUT:['We couldn’t delete these photos because it looks like you’re no longer signed in. <a href="/signin/?redir=/cameraroll/">Click here to sign in and try again</a>.'],DELETE_ERROR_UNKNOWN:['We couldn’t delete these photos because an unexpected error occurred. <a href="/cameraroll/">Click here to reload and try again</a>.'],NODATE:["No date"],YOU_HAVE_1000GB_OF_FREE_SPACE:["You have 1000GB of space."],UPLOAD_STRAIGHT_FROM_DESKTOP_WITH_UPLOADER:["Upload photos straight from your desktop."],DOWNLOAD_FLICKR_UPLOADR:["Download Flickr Uploadr"],DATE_TAKEN:["Date taken"],DATE_POSTED:["Date posted"],DATE_UPLOADED:["Date uploaded"],TOO_MANY_EDITS:["You may only edit data for ","${count}"," photos at a time."],ADD_TO_ALBUMS_PLURAL:[{type:"plural",valueName:"count",options:{one:"Add this photo to an album",other:"Add these photos to an album"}}],NEW_USER_PRO_INTRO:["A new way to browse, edit, and organize your photos.  Powered by unlimited storage and really smart Flickrbots. Many more features to come!"],NEW_USER_NONPRO_INTRO:["A new way to browse, edit, and organize your photos.  Powered by 1000 GB of free storage and really smart Flickrbots. Many more features to come!"],NEW_USER_JUMP:["Jump through years of photos with the timeline"],NEW_USER_EDIT:["Easily edit, create albums, and manage photos"],NEW_PHOTOS_UPLOADED:[{type:"plural",valueName:"count",options:{one:"${#} new photo has been uploaded",other:"${#} new photos have been uploaded"}}],NEW_PHOTOS_CATEGORIZED:[{type:"plural",valueName:"count",options:{one:"${#} new photo has been categorized",other:"${#} new tagged photos have been categorized"}}],NEW_USER_WELCOME_TITLE:["Welcome to Camera Roll!"],REFRESH:["Refresh"],NEW_USER_VIEW:["View photos by date taken or uploaded"],CAMERAROLL_BETA:["Beta"],PROVIDE_FEEDBACK:["Provide feedback on the new Camera Roll"],BUILDING_MAP:["Hey there, we're building your massive library, this might take a sec..."],SOFTWARE_DOWNLOAD:["Software download"],DOWNLOAD_TOS_COPY:["By downloading this software, you consent to its installation and the automatic installation of future updates, and you agree that you are subject to the Yahoo terms and Privacy Policy. You can uninstall this software at any time."],EMPTY_STATE_MESSAGE_NONPRO:["Upload to begin a new way to browse, edit, and organize your photos.  Powered by 1000 GB of free storage and really smart Flickrbots. Many more features to come!"],EMPTY_STATE_MESSAGE_PRO:["Upload to begin a new way to browse, edit, and organize your photos.  Powered by unlimited storage and really smart Flickrbots. Many more features to come!"],WELCOME_TO_CAMERAROLL:["Welcome to Camera Roll"],ALMOST:["(Almost...)"],NOT_ELIGIBLE:["Currently you are not eligible for the BETA test but we are working hard to get this great experience to every Flickr user very soon! Stay tuned!"],MODERN_DESKTOP_BROWSERS:["You qualify to experience this new way to browse, edit and organize your photos. However, you can only experience this exciting new feature on <strong>modern desktop browsers</strong>... for now ;)"],GO_TO_PHOTOSTREAM:["Go to Photostream"],CHANGES_APPLIED_TO_PHOTOS:["Changes have been applied to ",{type:"plural",valueName:"count",options:{one:"${#} photo",other:"${#} photos"}}],SHOW_INFO:["Show info"],FEEDBACK:["Feedback"],MULTIPLE_SELECT_VALUE:["Multiple"],GET_FLICKR_UPLOADR_FOR_MAC:["Get the Flickr Uploadr for Mac"],GET_FLICKR_UPLOADR_FOR_WINDOWS:["Get the Flickr Uploadr for Windows"],UPLOAD_THOUSANDS_OF_PHOTOS:["Upload thousands of photos at once"],INSTALL_NOW:["Install Now"],SMALL_BANNER_INSTALL:["Install Uploadr"],SMALL_BANNER_CTA:["Upload 1000s of photos fast"],SELECT_ALL:["Select all"],DATE_TITLE:[{type:"date",valueName:"intlDate",format:"long"}],MONTH:[{type:"date",valueName:"intlDate",format:"month"}],YEAR:[{type:"date",valueName:"intlDate",format:"year"}],PRIVACY:["Privacy"],EDIT:["Edit"],DELETE:["Delete"],CLEAR_SELECTION:["Clear selection"],ADD_NEW_TAGS:["Add new tags"],AUTOTAGS:["Autotags"],CAMERAROLL_SHARING_WARNING:["Careful! The private photos in this selection will be visible to anyone who has the share link. Is that really what you want?"],DO_NOT_REMIND_SHARING:["Don't remind me again"],DOWNLOAD_GENERIC_ERROR:["There was an error downloading this selection. Please try again."],TOO_MANY_SHARES:["You may only share ","${count}"," photos at a time."],PREPARING_DOWNLOAD:["Preparing download"],DOWNLOAD_NOT_AVAILABLE_ERROR:["There are no photos or videos available in this selection for you to download."],DOWNLOAD_DISABLED_ERROR:["Bulk downloading is currently unavailable. Please try again in a minute."],TOO_MANY_DOWNLOADS:["You may only download ","${count}"," photos at a time."],NO_AUTOTAGS_YET_UPLOAD_MORE:['It looks like our friendly robots haven’t spotted anything to <a href="https://help.yahoo.com/kb/flickr/tag-keywords-flickr-sln7455.html?soc_src=mail&soc_trk=ma">tag</a> in your photos just yet. <a href="https://www.flickr.com/upload">Why not upload some more?</a>'],NO_AUTOTAGS_YET:['It looks like our friendly robots haven’t spotted anything to <a href="https://help.yahoo.com/kb/flickr/tag-keywords-flickr-sln7455.html?soc_src=mail&soc_trk=ma">tag</a> in your photos just yet.'],UPLOAD_MORE:["Why not upload some more?"],MAGIC_VIEW:["Magic view"],INSTALL_FLICKR_UPLOADER_FOR_MAC:["Install Flickr Uploadr to quickly and safely backup your entire photo collection."],MAGIC_VIEW_TITLE_CASE:["Magic View"],SUBJECT_VIEW:["Subject view"],SUBJECT_VIEW_TITLE_CASE:["Subject View"],ALPHA_WARNING_TITLE:["Magic View Alpha: <em>Confidential</em>"],ALPHA_WARNING_BODY:["Shh, it’s a secret! Remember, you need to keep the new features and design you see in this alpha group secret. You can't tell your friends, post to your blog or even tweet about them before we launch for the rest of the Flickr community."],ALPHA_WARNING_BUTTON:["Mum's the word, got it!"],ERROR_SIGNED_OUT:['It looks like you’re no longer signed in. <a href="/signin/?redir=/cameraroll/">Click here to sign in and try again</a>.'],ERROR_BEFORE_EDITING_OUT:["Something went wrong while preparing your photos to be edited.  Please try again."],SELECT_PHOTO:["Select photo"],VIEW_ON_PHOTO_PAGE:["View on photo page"],ACCESSIBLE_ZOOM_ICON:["Click to zoom in."]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-template-bulk-download-modal",function(n,a){var e=n.Template.Handlebars.revive({1:function(n,a,e,l,t){var s,r=null!=a?a:{};return"\t<p>"+(null!=(s=e.if.call(r,null!=a?a.loggedOut:a,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.program(4,t,0),data:t}))?s:"")+'</p>\n\n\t<p class="copyright">'+(null!=(s=e.unless.call(r,null!=a?a.isOwnAlbum:a,{name:"unless",hash:{},fn:n.program(6,t,0),inverse:n.noop,data:t}))?s:"")+"</p>\n\n"},2:function(n,a,e,l,t){return n.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"downloadr.DOWNLOAD_WHEN_READY_LOGGED_OUT"},data:t}))},4:function(n,a,e,l,t){return n.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"downloadr.DOWNLOAD_WHEN_READY"},data:t}))},6:function(n,a,e,l,t){return n.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"downloadr.BE_SURE_RIGHTS"},data:t}))},8:function(n,a,e,l,t){var s,r=null!=a?a:{};return"\n"+(null!=(s=e.unless.call(r,null!=a?a.isOwnAlbum:a,{name:"unless",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=a?a.isMany:a,{name:"if",hash:{},fn:n.program(11,t,0),inverse:n.noop,data:t}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=a?a.isMany:a,{name:"if",hash:{},fn:n.program(13,t,0),inverse:n.program(16,t,0),data:t}))?s:"")},9:function(n,a,e,l,t){return"\t\t<p>"+n.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"album-page.DOWNLOAD_ALBUM_LICENSE_MESSAGE_ALT_2"},data:t}))+"</p>\n"},11:function(n,a,e,l,t){return"\t\t<p>"+n.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"album-page.ALOT_OF_PHOTOS"},data:t}))+"</p>\n"},13:function(n,a,e,l,t){var s;return"\t\t<ul>\n"+(null!=(s=e.each.call(null!=a?a:{},null!=a?a.downloadURLs:a,{name:"each",hash:{},fn:n.program(14,t,0),inverse:n.noop,data:t}))?s:"")+"\t\t</ul>\n"},14:function(n,a,e,l,t){var s,r=null!=a?a:{},i=e.helperMissing,u=n.escapeExpression;return"\t\t\t\t<li>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t"+u((e.intlMessage||a&&a.intlMessage||i).call(r,{name:"intlMessage",hash:{partSequence:null!=a?a.partSequence:a,intlName:"album-page.DOWNLOAD_ZIP_PART"},data:t}))+'\n\t\t\t\t\t</span>\n\t\t\t\t\t<a class="butt mini" href="'+u("function"==typeof(s=null!=(s=e.url||(null!=a?a.url:a))?s:i)?s.call(r,{name:"url",hash:{},data:t}):s)+'">'+u((e.intlMessage||a&&a.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"common.DOWNLOAD"},data:t}))+"</a>\n\t\t\t\t</li>\n"},16:function(n,a,e,l,t){var s,r,i=n.escapeExpression;return'\t\t<a class="butt mini" href="'+i(n.lambda(null!=(s=null!=(s=null!=a?a.downloadURLs:a)?s[0]:s)?s.url:s,a))+'">'+i("function"==typeof(r=null!=(r=e.buttonLabel||(null!=a?a.buttonLabel:a))?r:e.helperMissing)?r.call(null!=a?a:{},{name:"buttonLabel",hash:{},data:t}):r)+"</a>\n"},compiler:[7,">= 4.0.0"],main:function(n,a,e,l,t){var s;return null!=(s=e.if.call(null!=a?a:{},null!=a?a.doOffline:a,{name:"if",hash:{},fn:n.program(1,t,0),inverse:n.program(8,t,0),data:t}))?s:""},useData:!0}),l={};n.Array.each([],function(a){var e=n.Template.get("hermes/"+a);e&&(l[a]=e)}),n.Template.register("hermes/bulk-download-modal",function(a,t){return t=t||{},t.partials=t.partials?n.merge(l,t.partials):l,e(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-download-tooltip",function(n,e){var a=n.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(n,e,a,t,l){var r,i=null!=e?e:{},o=a.helperMissing,s=n.escapeExpression;return"<div>\n\t"+s("function"==typeof(r=null!=(r=a.content||(null!=e?e.content:e))?r:o)?r.call(i,{name:"content",hash:{},data:l}):r)+'\n\t<br/>\n\t<br/>\n\t<a class="close-onboarding">'+s("function"==typeof(r=null!=(r=a.confirmationLink||(null!=e?e.confirmationLink:e))?r:o)?r.call(i,{name:"confirmationLink",hash:{},data:l}):r)+"</a>\n</div>\n"},useData:!0}),t={};n.Array.each([],function(e){var a=n.Template.get("hermes/"+e);a&&(t[e]=a)}),n.Template.register("hermes/download-tooltip",function(e,l){return l=l||{},l.partials=l.partials?n.merge(t,l.partials):t,a(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("bulk-downloader-view",function(e,t){"use strict";e.BulkDownloaderView=e.Base.create("BulkDownloaderView",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.localizeLib=e.mix({langBundles:["common","album-page","cameraroll"],appContext:this.appContext},e.Localizable),this.set("isOwnAlbum",t.isOwnAlbum),this.doOffline=!!t.doOffline},showLoadingDialog:function(){return new e.Views.FluidModal({appContext:this.appContext,showCancelButton:!1,showFooter:!1,showActionButton:!1,title:this.intlMessage({intlName:"cameraroll.PREPARING_DOWNLOAD"}),message:this.templates("flickr-balls")({}),classList:"bulk-download-loading-dialog"}).show()},createTitle:function(e,t){var o="";if(e=e||0,t=t||0,e>0&&t>0)o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS_AND_VIDEO",photoCount:e,videoCount:t});else if(e>0&&0===t)o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS",photoCount:e});else{if(!(0===e&&t>0))throw new Error(this.intlMessage({intlName:"cameraroll.DOWNLOAD_NOT_AVAILABLE_ERROR"}));o=this.intlMessage({intlName:"album-page.DOWNLOAD_VIDEOS",videoCount:t})}return o},createButtonLabel:function(e,t){var o="";return t+e>1?o=this.intlMessage({intlName:"album-page.DOWNLOAD_ZIP"}):1===e&&0===t?o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS",photoCount:e}):0===e&&1===t&&(o=this.intlMessage({intlName:"album-page.DOWNLOAD_VIDEOS",videoCount:t})),o},prepareArchive:function(e){var t=this;return this.appContext.callAPI("flickr.download.archives.create",e).then(function(e){var o,n,i=e.archive.countPhotos,a=e.archive.countVideos,l=[],s=e.archive.key;return o=t.createTitle(i,a),n=t.createButtonLabel(i,a),l=e.archive.urls.map(function(e,t){return{url:e,partSequence:t+1}}),{title:o,downloadURLs:l,buttonLabel:n,key:s}}).catch(function(e){throw 105===e.code?new Error(t.intlMessage({intlName:"cameraroll.DOWNLOAD_DISABLED_ERROR"})):new Error(t.intlMessage({intlName:"cameraroll.DOWNLOAD_GENERIC_ERROR"}))})},showDownloadDialog:function(o){var n,i,a=o.title,l=this,s=o.downloadURLs||[];return this.doOffline&&((n=o.setID?{set_id:o.setID}:o.share_code?{share_code:o.share_code,gp_code:o.gp_code,gp_owner:o.gp_owner}:{photo_ids:o.photoIDs,owner_id:o.ownerID}).extras="offline_enabled"),i=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!this.doOffline,showCancelButton:!!this.doOffline,showFooter:!!this.doOffline,showActionButton:!!this.doOffline,actionButtonLabel:this.doOffline?this.intlMessage({intlName:"downloadr.CREATE_ZIP"}):"",title:a,message:this.templates("bulk-download-modal")({isMany:s.length>1,downloadURLs:s,buttonLabel:o.buttonLabel,isOwnAlbum:this.get("isOwnAlbum"),doOffline:this.doOffline,loggedOut:!this.appContext.getViewer().signedIn}),classList:"bulk-download-dialog"}).show(),l.doOffline?(i.on("actionClick",function(o){o.preventDefault(),e.rapidTracker.beacon(t,"completeArchiveDownloadClick"),i.get("container").one(".copyright").setHTML(l.templates("flickr-balls")({})),l.prepareArchive(n).then(function(e){i.close(),l.appContext.getViewer().signedIn?l.showTooltip(e.key):l.appContext.flapp.navigate("/download/"+e.key)}).catch(function(t){105===t.code?l.onError(new Error(l.intlMessage({intlName:"cameraroll.DOWNLOAD_DISABLED_ERROR"})),i):(e.config.win.beaconError("[bulk-download] Error creating archive ",e.config.win.location.href,t),l.onError(new Error(l.intlMessage({intlName:"cameraroll.DOWNLOAD_GENERIC_ERROR"})),i))})}),i.on("cancelClick",function(o){o.preventDefault(),e.rapidTracker.beacon(t,"archiveCancelClick"),i.close()})):i.on("activated",function(){i.get("container").all(".butt").on("click",function(o){1===s.length?(e.rapidTracker.beacon(t,"completeArchiveDownloadClick"),i.close()):(e.rapidTracker.beacon(t,"partialArchiveDownloadClick"),o.target.addClass("is-disabled"))})}),i},onError:function(t,o){o&&o.close(),new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:t.message,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()},showTooltip:function(t){var o=e.one(".global-nav-view").one(".notifications-menu-view"),n=this;if(o){this.tooltip=new e.Views.FluidDroparound({appContext:this.appContext,htmlMessage:this.templates("download-tooltip")({content:this.intlHTMLMessage({intlName:"downloadr.TOOLTIP_DOWNLOAD_LINK_MESSAGE",url:"/download/"+t}),confirmationLink:this.intlMessage({intlName:"downloadr.TOOLTIP_OK"})}),showDropArrow:!0,dismissOnOverlayClick:!0,observePageResize:!0,anchorElement:o,keyboardAnchorElement:o,minVerticalSpace:400,width:350,positionFixed:!0,preferLeft:!0,closeOnScroll:!0,anchorOffsetHorizontal:11,anchorOffsetVertical:0});var i=this.tooltip.get("container");n.registerEventHandler(i.delegate("click",function(e){e.preventDefault(),n.tooltip.close()},".close-onboarding")),this.tooltip.show()}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-bulk-download-modal","hermes-template-download-tooltip","hermes-template-flickr-balls"],langBundles:["common","downloadr","album-page","cameraroll"],optional:[],affinity:"client"});YUI.add("html-file-dragdrop",function(e){"use strict";var r="htmlFileDragDrop",o=r+"-drag-over",t=r+"-error",i=["image/png","image/jpeg"];e.HtmlFileDragDrop=function(r){e.config.win.File&&e.config.win.FileList&&e.config.win.FileReader&&r.dropZone&&(this.dropZone=e.one(r.dropZone),this.dropZone.on("dragover",this.handleDragOver.bind(this)),this.dropZone.on("dragleave",this.handleDragLeave.bind(this)),this.dropZone.on("drop",this.handleDrop.bind(this)))},e.HtmlFileDragDrop.prototype.reset=function(){this.dropZone.removeClass(t),this.dropZone.removeClass(o)},e.HtmlFileDragDrop.prototype.handleDragOver=function(e){e.halt(),this.reset(),this.dropZone.addClass(o)},e.HtmlFileDragDrop.prototype.handleDragLeave=function(e){e.halt(),this.reset()},e.HtmlFileDragDrop.prototype.showError=function(){this.dropZone.addClass(t)},e.HtmlFileDragDrop.prototype.handleDrop=function(e){var r;if(e.halt(),this.dropZone.removeClass(o),e._event.dataTransfer.files.length>1)return this.dropZone.addClass(t),void this.fire("drop",new Error("FILE_COUNT"));if((r=e._event.dataTransfer.files[0])&&r.name){if(i.indexOf(r.type)<0)return void this.fire("drop",new Error("FILE_TYPE"));this.fire("drop",r)}},e.augment(e.HtmlFileDragDrop,e.EventTarget,!0,null,{prefix:r})},"@VERSION@",{affinity:"",requires:["event-custom"],optional:[]});YUI.add("hermes-template-photo-selector",function(t,e){var s=t.Template.Handlebars.revive({1:function(t,e,s,a,n){return'\t\t<div class="photo-selector-search-list-yours">\n\t\t\t<div class="photo-selector-search-list">\n\t\t\t\t<div class="photo-selector-search-list-container">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n'},3:function(t,e,s,a,n){return'\t\t<div class="photo-selector-search-list-contacts">\n\t\t\t<div class="photo-selector-search-list">\n\t\t\t\t<div class="photo-selector-search-list-container">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n'},5:function(t,e,s,a,n){return'\t\t<div class="photo-selector-search-list-everyone">\n\t\t\t<div class="photo-selector-search-list">\n\t\t\t\t<div class="photo-selector-search-list-container">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n'},7:function(t,e,s,a,n){return'\t\t<div class="photo-selector-search-list-marketplace"\n\t\t\t<div class="photo-selector-search-list">\n\t\t\t\t<div class="photo-selector-search-list-container">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n'},9:function(t,e,s,a,n){var l=null!=e?e:{},i=s.helperMissing,o=t.escapeExpression;return'<div class="photo-selector-upload is-hiding">\n\t<p class="upload-error"></p>\n\t<div class="drop-zone">\n\t\t<div class="drop-zone-content">\n\t\t\t<div class="balls"></div>\n\t\t\t<input type="file" class="file-select" name="file-select" accept="image/jpeg, image/png" />\n\t\t\t<p><i class="upload-icon"></i>'+o((s.intlHTMLMessage||e&&e.intlHTMLMessage||i).call(l,{name:"intlHTMLMessage",hash:{intlName:"wallart.DRAG_DROP_TO_UPLOAD"},data:n}))+"</p>\n\t\t\t<p>"+o((s.intlHTMLMessage||e&&e.intlHTMLMessage||i).call(l,{name:"intlHTMLMessage",hash:{intlName:"wallart.PHOTOS_UPLOADED_AS_PRIVATE"},data:n}))+'</p>\n\t\t</div>\n\t</div>\n\t<ul class="preview"></ul>\n</div>\n'},11:function(t,e,s,a,n){return'<div class="group-photo-selector-photos-wrapper">\n\t<div class="group-photo-selector-photos photo-selector-photos">\n\t\t<div class="group-photo-selector-photos-container">\n\t\t</div>\n\t</div>\n</div>\n'},compiler:[7,">= 4.0.0"],main:function(t,e,s,a,n){var l,i=null!=e?e:{};return'<div class="photo-selector-title-bar hidden">\n\t<div class="back-to-list">'+t.escapeExpression((s.intlMessage||e&&e.intlMessage||s.helperMissing).call(i,{name:"intlMessage",hash:{intlName:"common.PHOTO_SELECTOR_BACK_TO_ALBUM_LIST"},data:n}))+'</div>\n\t<div class="title"></div>\n</div>\n\n<div class="photo-selector-photos-wrapper">\n\t<div class="photo-selector-photos">\n\t\t<div class="photo-selector-photos-container">\n\t\t\t<div class="loader"><div class="balls"></div></div>\n\t\t</div>\n\t</div>\n</div>\n\n\n<div class="photo-selector-search-lists-wrapper is-hiding">\n'+(null!=(l=s.if.call(i,null!=(l=null!=e?e.searchable:e)?l.yours:l,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n}))?l:"")+"\n"+(null!=(l=s.if.call(i,null!=(l=null!=e?e.searchable:e)?l.contacts:l,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n}))?l:"")+"\n"+(null!=(l=s.if.call(i,null!=(l=null!=e?e.searchable:e)?l.everyone:l,{name:"if",hash:{},fn:t.program(5,n,0),inverse:t.noop,data:n}))?l:"")+"\n"+(null!=(l=s.if.call(i,null!=(l=null!=e?e.searchable:e)?l.marketplace:l,{name:"if",hash:{},fn:t.program(7,n,0),inverse:t.noop,data:n}))?l:"")+"</div>\n\n"+(null!=(l=s.if.call(i,null!=e?e.hasUploadCapabilities:e,{name:"if",hash:{},fn:t.program(9,n,0),inverse:t.noop,data:n}))?l:"")+"\n"+(null!=(l=s.if.call(i,null!=e?e.hasGroupCapabilities:e,{name:"if",hash:{},fn:t.program(11,n,0),inverse:t.noop,data:n}))?l:"")},useData:!0}),a={};t.Array.each([],function(e){var s=t.Template.get("hermes/"+e);s&&(a[e]=s)}),t.Template.register("hermes/photo-selector",function(e,n){return n=n||{},n.partials=n.partials?t.merge(a,n.partials):a,s(e,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-list-aft",function(t,n){var e=t.Template.Handlebars.revive({1:function(t,n,e,a,i){var r=t.lambda,l=t.escapeExpression;return"\t\t\t\t\timg = new Image();\n\t\t\t\t\timg.addEventListener('load', function onImageLoad (event) {\n\t\t\t\t\t\tthis.removeEventListener('load', onImageLoad);\n\t\t\t\t\t\ttimingCache['"+l(r(null!=n?n.id:n,n))+"'] = new Date().getTime();\n\t\t\t\t\t});\n\t\t\t\t\timg.src='"+l(r(null!=n?n.url:n,n))+"';\n"},compiler:[7,">= 4.0.0"],main:function(t,n,e,a,i){var r,l,o=null!=n?n:{},s=e.helperMissing,c=t.escapeExpression;return'<script type="text/javascript" nonce="'+c("function"==typeof(l=null!=(l=e.cspNonce||(null!=n?n.cspNonce:n))?l:s)?l.call(o,{name:"cspNonce",hash:{},data:i}):l)+"\">\n\ttry {\n\n\t\t(function () {\n\n\t\t\t\tif (!window.paftTiming) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar timingCache = {},\n\t\t\t\t    img;\n\n\t\t\t\twindow.paftTiming['"+c("function"==typeof(l=null!=(l=e.photolistId||(null!=n?n.photolistId:n))?l:s)?l.call(o,{name:"photolistId",hash:{},data:i}):l)+"'] = timingCache;\n\n"+(null!=(r=e.each.call(o,null!=n?n.photos:n,{name:"each",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i}))?r:"")+"\n\t\t})();\n\n\t} catch (error) {\n\n\t\tif (window.sendRequest){\n\t\t\twindow.sendRequest('flickr.hermes.photolistAFT.failure', 'Photolist timing failed.');\n\t\t}\n\t}\n<\/script>\n"},useData:!0}),a={};t.Array.each([],function(n){var e=t.Template.get("hermes/"+n);e&&(a[n]=e)}),t.Template.register("hermes/photo-list-aft",function(n,i){return i=i||{},i.partials=i.partials?t.merge(a,i.partials):a,e(n,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-infinite-scroll-load-more",function(e,a){var t=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,t,l,n){return'<div class="infinite-scroll-load-more">\n\t<button class="alt">'+e.escapeExpression((t.intlMessage||a&&a.intlMessage||t.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.LOAD_MORE_RESULTS"},data:n}))+"</button>\n</div>"},useData:!0}),l={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(l[a]=t)}),e.Template.register("hermes/infinite-scroll-load-more",function(a,n){return n=n||{},n.partials=n.partials?e.merge(l,n.partials):l,t(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-license-detail",function(e,a){var s=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,s,l,t){var n=null!=a?a:{},i=s.helperMissing,r=e.escapeExpression;return'<p class="secondary" style="margin-top: 0;">'+r((s.intlMessage||a&&a.intlMessage||i).call(n,{name:"intlMessage",hash:{intlName:null!=a?a.title:a},data:t}))+'</p>\n<p class="secondary" style="margin-bottom: 0;">'+r((s.intlMessage||a&&a.intlMessage||i).call(n,{name:"intlMessage",hash:{intlName:null!=a?a.body:a},data:t}))+"</p>\n"},useData:!0}),l={};e.Array.each([],function(a){var s=e.Template.get("hermes/"+a);s&&(l[a]=s)}),e.Template.register("hermes/license-detail",function(a,t){return t=t||{},t.partials=t.partials?e.merge(l,t.partials):l,s(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-list-layout-row",function(t){(t.PhotoListLayoutRow=function(t){this.top=t.top,this.left=t.left,this.width=t.width,this.spacing=t.spacing,this.targetRowHeight=t.targetRowHeight,this.targetRowHeightTolerance=t.targetRowHeightTolerance,this.additionalHeight=t.additionalHeight||0,this.minAspectRatio=this.width/t.targetRowHeight*(1-t.targetRowHeightTolerance),this.maxAspectRatio=this.width/t.targetRowHeight*(1+t.targetRowHeightTolerance),this.edgeCaseMinRowHeight=t.edgeCaseMinRowHeight||Number.NEGATIVE_INFINITY,this.edgeCaseMaxRowHeight=t.edgeCaseMaxRowHeight||Number.POSITIVE_INFINITY,this.rightToLeft=t.rightToLeft,this.isBreakoutRow=t.isBreakoutRow,this.items=[],this.height=0}).prototype={addItem:function(i){var e,h,s,o=this.items.concat(i),a=this.width-(o.length-1)*this.spacing,g=o.reduce(function(t,i){return t+i.aspectRatio},0),r=a/this.targetRowHeight;return this.isBreakoutRow&&0===this.items.length&&i.aspectRatio>=1?(this.items.push(t.merge(i)),this._completeLayout(a/i.aspectRatio),!0):0!==g&&(g<this.minAspectRatio?(this.items.push(t.merge(i)),!0):g>this.maxAspectRatio?0===this.items.length?(this.items.push(t.merge(i)),this._completeLayout(a/g),!0):(e=this.width-(this.items.length-1)*this.spacing,h=this.items.reduce(function(t,i){return t+i.aspectRatio},0),s=e/this.targetRowHeight,Math.abs(g-r)>Math.abs(h-s)?(this._completeLayout(e/h),!1):(this.items.push(t.merge(i)),this._completeLayout(a/g),!0)):(this.items.push(t.merge(i)),this._completeLayout(a/g),!0))},forceComplete:function(t,i){var e=this.width-(this.items.length-1)*this.spacing,h=this.items.reduce(function(t,i){return t+i.aspectRatio},0);"number"==typeof i?this._completeLayout(i,!1):t?this._completeLayout(e/h):this._completeLayout(this.targetRowHeight,!1)},isLayoutComplete:function(){return this.height>0},getItems:function(){return this.rightToLeft?this.items.reverse():this.items},getIndexOfItem:function(t){var i=-1;return this.items.some(function(e,h){if(e.id===t)return i=h,!0}),i},setTop:function(t){this.top=t,this.items.forEach(function(i){i.geometry.top=t})},_completeLayout:function(t,i){var e,h,s,o,a,g,r=this.rightToLeft?-this.left:this.left,n=this.width-(this.items.length-1)*this.spacing,m=this;void 0===i&&(i=!0),(h=Math.round(t))!==(s=Math.max(this.edgeCaseMinRowHeight,Math.min(h,this.edgeCaseMaxRowHeight)))?(this.height=s,e=n/s/(n/h)):(this.height=h,e=1),this.items.forEach(function(t,i){t.geometry={top:m.top,width:Math.round(t.aspectRatio*m.height*e),height:m.height+m.additionalHeight},m.rightToLeft?t.geometry.left=m.width-r-t.geometry.width:t.geometry.left=r,r+=t.geometry.width+m.spacing}),this.height+=m.additionalHeight,i&&(this.rightToLeft||(r-=this.spacing+this.left),o=(r-this.width)/this.items.length,a=this.items.map(function(t,i){return Math.round((i+1)*o)}),1===this.items.length?((g=this.items[0].geometry).width-=Math.round(o),this.rightToLeft&&(g.left+=Math.round(o))):this.items.forEach(function(t,i){i>0?(t.geometry.left-=a[i-1],t.geometry.width-=a[i]-a[i-1]):t.geometry.width-=a[i]}))}}},"@VERSION@",{requires:[]});YUI.add("photo-list-layout",function(t,e){var i=require("hermes-core/flog")(e),a={containerPadding:{top:8,right:8,bottom:8,left:8},itemSpacing:{horizontal:8,vertical:8},targetRowHeight:320,targetRowHeightTolerance:.25,awakeBoundsToViewportSizeRatio:3,maxNumRows:Number.POSITIVE_INFINITY,forceAspectRatio:Number.NaN,alwaysDisplayOrphans:!1,sleepTopAndBottom:!0,sleepLeftAndRight:!1,fullWidthBreakoutRowCadence:!1,deferWakeSleepUntil:2500};(t.PhotoListLayout=function(e){if(!e.appContext)throw new Error("PhotoListLayout must be instantiated with `params.appContext`.");e=t.merge(a,e),this.appContext=e.appContext,this.containerWidth=e.containerWidth,this.viewportContainerNodeHeight=e.viewportContainerNodeHeight||this.appContext.viewportData.getHeight(),this.containerPadding=e.containerPadding,this.itemSpacing=e.itemSpacing,this.targetRowHeight=e.targetRowHeight,this.targetRowHeightTolerance=e.targetRowHeightTolerance,this.awakeBoundsToViewportSizeRatio=e.awakeBoundsToViewportSizeRatio,this.maxNumRows=e.maxNumRows,this.forceAspectRatio=e.forceAspectRatio,this.alwaysDisplayOrphans=e.alwaysDisplayOrphans,this.sleepTopAndBottom=e.sleepTopAndBottom,this.sleepLeftAndRight=e.sleepLeftAndRight,this.fullWidthBreakoutRowCadence=e.fullWidthBreakoutRowCadence,this.deferWakeSleepUntil=e.deferWakeSleepUntil,this.additionalHeight=e.additionalHeight||0,this._layoutItems=[],this._awakeItems=[],this._inViewportItems=[],this._leadingOrphans=[],this._trailingOrphans=[],this._containerHeight=this.containerPadding.top,this._rows=[],this._orphans=[]}).prototype={getCurrentLayout:function(){return this._layoutItems.concat()},getAwakeItems:function(){return this._awakeItems.concat()},getInViewportItems:function(){return this._inViewportItems.concat()},hasLimitedNumberOfRows:function(){return this.maxNumRows!==a.maxNumRows},getLayoutItem:function(t){var e=null;return this._layoutItems.some(function(i){if(i.id===t)return e=i,!0}),e},getItemsInRow:function(t){return this._rows.length<=t?[]:this._rows[t].items.concat()},invalidateItem:function(t){var e,i=function(i,a,o){if(i.id===t)return o.splice(a,1),e=!0,!0};return this._layoutItems.some(i),this._leadingOrphans.some(i),this._trailingOrphans.some(i),this._rows.some(function(t){return t.items.some(i)}),this._orphans.some(i),e},clear:function(){this._layoutItems=[],this._leadingOrphans=[],this._trailingOrphans=[],this._containerHeight=this.containerPadding.top,this._rows=[],this._orphans=[]},updateTargetRowHeight:function(t){this.targetRowHeight=t,this.updatedRowHeight=this.targetRowHeight},computeLayout:function(t,e,a,o){var s,n,h,r,l,c,g,p,d,u={},m=[],w=[],f=[],_=!1,y=this;switch(this.containerWidth||(i.log("No valid containerWidth set on photo-list-layout; falling back to default"),this.containerWidth=1060),t||(t=[]),this.forceAspectRatio&&t.forEach(function(t){t.forcedAspectRatio=!0,t.aspectRatio=y.forceAspectRatio}),s=this._layoutItems.concat(),this._layoutItems.forEach(function(t){u[t.id]=t}),o||(o={diffType:"append"}),o.diffType){case"prepend":t=t.concat(this._leadingOrphans),this._leadingOrphans=[],t.reverse(),_=!0;break;case"merge":i.log("Due to the whims of product management, `merge` layouts are not yet implemented."),this.updateLayoutFrom(t,o.mergeStartIndex);break;case"relayout":o.diffDirection?"top"===o.diffDirection?t=t.concat(this._leadingOrphans.concat(this._layoutItems.concat(this._trailingOrphans))):"bottom"===o.diffDirection&&(t=this._leadingOrphans.concat(this._layoutItems.concat(this._trailingOrphans)).concat(t)):t=this._leadingOrphans.concat(this._layoutItems.concat(this._trailingOrphans)),this.clear();break;case"append":default:t=this._trailingOrphans.concat(t),this._trailingOrphans=[],this._rows.length>1&&(this._containerHeight=this._containerHeight-this.containerPadding.bottom+this.itemSpacing.vertical)}return t.some(function(t,e){if(r=!1,n||(n=y.createNewRow(_)),h=n.addItem(t),n.isLayoutComplete()){if(m=m.concat(y.addRow(n,_)),y._rows.length>=y.maxNumRows)return n=null,!0;if(n=y.createNewRow(_),!h)if(h=n.addItem(t),n.isLayoutComplete()){if(m=m.concat(y.addRow(n,_)),y._rows.length>=y.maxNumRows)return n=null,!0;n=y.createNewRow(_)}else h||(r=!0)}else h||(r=!0);r&&i.warn("computeLayout() Item not added and layout not complete",t)}),this._rows.length>=this.maxNumRows?(this._layoutItems||(i.warn("computeLayout() LayoutItems are unexpectedly undefined"),this._layoutItems=[]),this._trailingOrphans=t.slice(this._layoutItems.length)):n&&n.getItems().length&&(_?o.firstPage?(n.forceComplete(!0),m=m.concat(y.addRow(n,_))):this._leadingOrphans=n.getItems().reverse():o.lastPage||this.alwaysDisplayOrphans?(this._rows.length?(d=this._rows[this._rows.length-1].isBreakoutRow?this._rows[this._rows.length-1].targetRowHeight:this._rows[this._rows.length-1].height,n.forceComplete(!1,this.updatedRowHeight||d-this.additionalHeight)):this.alwaysDisplayOrphans&&s.length?s[s.length-1].geometry&&n.forceComplete(!1,this.updatedRowHeight||s[s.length-1].geometry.height):n.forceComplete(!1),m=m.concat(y.addRow(n,_)),delete this.updatedRowHeight):this._trailingOrphans=n.getItems().concat()),m.forEach(function(t){u[t.id]?f.push(t):w.push(t)}),this._containerHeight=this._containerHeight-this.itemSpacing.vertical+this.containerPadding.bottom,_&&(p=this.containerPadding.top,this._rows.forEach(function(t){t.setTop(p),p+=t.height+y.itemSpacing.vertical}),f=s.concat()),g=this.computeWakeSleep(e,a,u),l=g.wakeSleepChangedItems,c=g.inViewportChangedItems,this._trailingOrphans.concat(this._leadingOrphans).forEach(function(t){u[t.id]&&(t.isAwake=!1,l.push(t))}),{allLayoutItems:this._layoutItems.concat(),newItems:w,layoutChangedItems:f,wakeSleepChangedItems:l,inViewportChangedItems:c,leadingOrphans:this._leadingOrphans.concat(),trailingOrphans:this._trailingOrphans.concat(),containerHeight:this._containerHeight}},computeWakeSleep:function(t,e,a){var o=this._awakeItems=[],s=this._inViewportItems=[];t||(t=0),e||(e=0),this.viewportContainerNodeHeight||(i.log("No valid viewport height available for photo-list-layout; falling back to default"),this.viewportContainerNodeHeight=1e3);var n,h,r,l,c,g=this.viewportContainerNodeHeight,p=.5*g*(this.awakeBoundsToViewportSizeRatio-1),d=t,u=t+g,m=d-p,w=u+p,f=[],_=[],y=this._layoutItems.length<this.deferWakeSleepUntil,I=this;return this.sleepLeftAndRight&&(h=.5*(n=this.appContext.viewportData.getWidth())*(this.awakeBoundsToViewportSizeRatio-1),r=e-h,l=e+n+h),this._layoutItems.forEach(function(t){a&&(c=a[t.id]),y?t.isAwake=!0:(I.sleepTopAndBottom?t.isAwake=t.geometry.top+t.geometry.height>=m&&t.geometry.top<w:t.isAwake=!0,t.isAwake&&I.sleepLeftAndRight&&(t.isAwake=t.geometry.left+t.geometry.width>=r&&t.geometry.left<l)),c&&c.isAwake===t.isAwake||f.push(t),t.isAwake&&o.push(t),t.isInViewport=t.geometry.top+t.geometry.height>=d&&t.geometry.top<u,_.push(t),t.isInViewport&&s.push(t)}),{allLayoutItems:a?this._layoutItems:this._layoutItems.concat(),newItems:[],layoutChangedItems:[],wakeSleepChangedItems:f,inViewportChangedItems:_,leadingOrphans:this._leadingOrphans.concat(),trailingOrphans:this._trailingOrphans.concat(),containerHeight:this._containerHeight}},updateLayoutFrom:function(t,e){var i,a,o,s;this._layoutItems.length&&this._layoutItems.length>e&&(i=this._layoutItems[e],(a=this.getRowOfItem(i.id))&&(this._rows=this._rows.slice(0,a.index),o=this._rows[this._rows.length-1],this._containerHeight=o?o.top+o.height:0,a.indexInRow>0&&(s=(s=this._layoutItems.splice(-a.indexInRow)).map(function(t){return{id:t.id,aspectRatio:t.aspectRatio,layoutType:t.layoutType}}),t.unshift.apply(t,s))),this._layoutItems=this._layoutItems.slice(0,Math.min(this._layoutItems.length,e)))},createNewRow:function(e){var i=!1;return!1!==this.fullWidthBreakoutRowCadence&&(this._rows.length+1)%this.fullWidthBreakoutRowCadence==0&&(i=!0),new t.PhotoListLayoutRow({top:this._containerHeight,left:this.containerPadding.left,width:this.containerWidth-this.containerPadding.left-this.containerPadding.right,spacing:this.itemSpacing.horizontal,targetRowHeight:this.targetRowHeight,targetRowHeightTolerance:this.targetRowHeightTolerance,edgeCaseMinRowHeight:.5*this.targetRowHeight,edgeCaseMaxRowHeight:2*this.targetRowHeight,rightToLeft:e,isBreakoutRow:i,additionalHeight:this.additionalHeight})},addRow:function(t,e){return e?(this._rows.unshift(t),this._layoutItems=t.getItems().reverse().concat(this._layoutItems)):(this._rows.push(t),this._layoutItems=this._layoutItems.concat(t.getItems())),this._containerHeight+=t.height+this.itemSpacing.vertical,t.items},getRowOfItem:function(t){var e,i,a;for(i=0;i<this._rows.length;i++)if(e=this._rows[i],-1!==(a=e.getIndexOfItem(t)))return{row:e,index:i,indexInRow:a};return null}}},"@VERSION@",{requires:["photo-list-layout-row"]});YUI.add("hermes-template-photo-list-photo",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,r,t){var l;return(null!=(l=n.if.call(null!=a?a:{},null!=a?a.showInteractionBarPlaceholder:a,{name:"if",hash:{},fn:e.program(2,t,0),inverse:e.noop,data:t}))?l:"")+'\t<div class="interaction-view"></div>\n'},2:function(e,a,n,r,t){return'\t\t<div class="interaction-view-placeholder"></div>\n'},4:function(e,a,n,r,t){var l;return'\t<a class="click-target" href="'+e.escapeExpression("function"==typeof(l=null!=(l=n.photoPageUrl||(null!=a?a.photoPageUrl:a))?l:n.helperMissing)?l.call(null!=a?a:{},{name:"photoPageUrl",hash:{},data:t}):l)+'" tabindex="0" role="heading" aria-level="3"></a>\n'},compiler:[7,">= 4.0.0"],main:function(e,a,n,r,t){var l;return null!=(l=n.if.call(null!=a?a:{},null!=a?a.hasInteraction:a,{name:"if",hash:{},fn:e.program(1,t,0),inverse:e.program(4,t,0),data:t}))?l:""},useData:!0}),r={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(r[a]=n)}),e.Template.register("hermes/photo-list-photo",function(a,t){return t=t||{},t.partials=t.partials?e.merge(r,t.partials):r,n(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-list-photo-view",function(e){var t=require("hermes-core/type-validator");e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.set("isZombie",!YUI.Env.isServer&&e.requiredToShowOnServer&&this.get("layoutItem")&&!this.get("layoutItem").isAwake),this},loadState:function(){var t=e.URLHelper.getPhotoPage({photoId:this.get("model").getValue("id"),pathAlias:this.get("model").getValue("owner").getValue("pathAlias"),contextSuffix:this.get("contextSuffix")});return this.set("photoPageUrl",t),e.Promise.resolve()},buildContainer:function(){var t,i=this.get("container"),r=this.get("layoutItem");if(r.isAwake)this.updateGeometry(),this.setContainerHTML(this.render()),YUI.Env.isServer?(i.setStyles({"background-image":"url("+this.get("photoUrl")+")"}),i.addClass("awake"),this.get("model").getValue("needsInterstitial")&&i.addClass("restricted-image")):(this.get("showLowResImageFirst")&&i.setStyles({backgroundImage:"url("+this.get("model").getValue("sizes").sq.url+")"}).addClass("low-res"),this.downloadCacheAndSetImage());else if(YUI.Env.isServer)this.set("isZombie",!0);else if(!YUI.Env.isServer||this.get("isZombie")){var a="";t=e.Node.create(this.get("placeHolderHTML")).set("innerHTML",this.render()),this.get("model").getValue("needsInterstitial")&&(a=" restricted-image"),t.setAttrs({id:i.getAttribute("id"),className:i.getAttribute("class")+a}),this.updateNodeGeometry(r,t),this.serialize(t),this.set("isReallySleeping",!0),this.set("isZombie",!1),this.downloadCacheAndSetImage()}return this.get("model").getValue("isVideo")&&this.get("container").addClass("is-video"),this.get("showInteractionBarPlaceholder")&&(this.get("model").getValue("aspectRatio")>1?i.addClass("landscape"):i.addClass("portrait")),this},activate:function(){var e;return this.renderInteractionView().then(function(e){this.fire("activated")}.bind(this)),this.get("showLowResImageFirst")&&((e=this.get("parentContainer").getDOMNode()).addEventListener("transitionend",this.removeTransition),e.addEventListener("webkitTransitionEnd",this.removeTransition)),this.registerEventHandler(this.get("interactionContainer").delegate(["blur","focus"],this.toggleKeyboardFocusStyling.bind(this),"a")),this},toggleKeyboardFocusStyling:function(e){var t=e.target.ancestor(".interaction-view");t&&t.toggleClass("has-keyboard-focus")},setHoverVisible:function(e){var t=this.get("interactionContainer");t&&(e?t.addClass("manual-hover"):t.removeClass("manual-hover"))},render:function(){return this.templates("photo-list-photo")({photoPageUrl:this.get("photoPageUrl"),hasInteraction:!!this.get("interactionViewName")&&!this.appContext.forceServerRender,showInteractionBarPlaceholder:this.get("showInteractionBarPlaceholder")})},removeTransition:function(e){e&&e.target&&e.target.classList&&e.target.classList.contains("photo-list-photo-view")&&e.target.classList.remove("low-res")},downloadCacheAndSetImage:function(){e.fluid.loadImage(this.get("photoUrl"),{timeout:1e3,retry:!0}).then(function(e){this.handleImageLoad(!0,e)}.bind(this),function(e){this.handleImageLoad(!1,e+"?retry="+Date.now())}.bind(this))},handleImageLoad:function(t,i){var r,a=this.get("isReallySleeping");(r=a?this.deserialize():this.get("container")).setStyle("backgroundImage","url("+i+")"),t||r.setStyle("backgroundColor","#eee"),this.get("model").getValue("needsInterstitial")&&r.addClass("restricted-image"),a?this.serialize(r):e.fluid.chill(function(){var e=this.get("container");a||(e.addClass("awake"),this.fire(t?"loaded":"loadError"))},this),r=null},updateGeometry:function(e){var t,i=this.get("isReallySleeping");e?this.set("layoutItem",e):e=this.get("layoutItem"),t=i?this.deserialize():this.get("container"),this.updateNodeGeometry(e,t),i&&this.serialize(t),t=null},updateNodeGeometry:function(t,i){YUI.Env.isServer?i.setStyles({transform:"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-webkit-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-ms-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)"}):e.fluid.setStylePrefixed("transform","translate("+t.geometry.left+"px, "+t.geometry.top+"px)",i),i.setStyles({width:t.geometry.width+"px",height:t.geometry.height+"px"})},sleep:function(){var t,i;this.get("isReallySleeping")||(YUI.Env.isServer?this.set("isZombie",!0):(this.get("id"),this.destroyInteractionView(),(i=this.get("container")).removeClass("awake"),this.serialize(i),t=e.Node.create(this.get("placeHolderHTML")),this.get("parentContainer").replaceChild(t,i),this.set("container",t),this.set("isReallySleeping",!0),this.set("isZombie",!1),i=null))},wake:function(){var t,i,r;this.get("isReallySleeping")&&(this.get("id"),t=this.get("container"),i=this.get("parentContainer"),r=this.deserialize(),i.replaceChild(r,t),this.set("container",r),this.set("isReallySleeping",!1),this.renderInteractionView(),e.fluid.chill(function(){this.get("container").addClass("awake")},this),t=null)},isAwake:function(){return!this.get("isReallySleeping")},serialize:function(t){if(YUI.Env.isServer)throw new Error("Impossible to `serialize` on the server (uses sessionStorage). Maybe you meant to call `sleep`?");t&&e.Storage.Instance.set(this.get("storageId"),t.getDOMNode().outerHTML)},deserialize:function(){if(YUI.Env.isServer)throw new Error("Impossible to `deserialize` on the server (uses sessionStorage). Maybe you meant to call `wake`?");var t,i=e.Storage.Instance.get(this.get("storageId"));return i&&(t=e.Node.create(i),this.dematerialize()),t},dematerialize:function(){if(YUI.Env.isServer)throw new Error("Impossible to `dematerialize` on the server (uses sessionStorage).");e.Storage.Instance.remove(this.get("storageId"))},renderInteractionView:function(){var t,i=this.get("interactionViewName"),r=this.get("interactionView");return i&&!r?this.appContext.getView(i,e.merge(this._params,{id:this.get("id"),container:this.get("interactionContainer"),model:this.get("model"),listModelParams:this.get("listModelParams"),photoPageUrl:this.get("photoPageUrl"),isActiveViewAgnostic:this.get("isActiveViewAgnostic"),engagementModelName:this.get("engagementModelName"),layoutWidth:this.get("layoutItem").geometry.width})).then(function(e){return this.set("interactionView",e),e.initialize()}.bind(this)):r?(r.get("container").inDoc()||((t=r.get("container")).addClass("interaction-view"),this.get("interactionContainer")||this.buildContainer(),this.get("container").replaceChild(t,this.get("interactionContainer")),r.normalizedActivate()),e.Promise.resolve(r)):e.Promise.resolve(null)},destroyInteractionView:function(){var e=this.get("interactionView");e&&(e.destroy(),this.set("interactionView",null))},destructor:function(){this.dematerialize()}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,i){return t.photoId(e)}},parentSignature:{writeOnce:"initOnly"},storageId:{readOnly:!0,derivedBy:["id","parentSignature"],getter:function(){return this.get("parentSignature")+"-"+this.get("id")}},layoutItem:{validator:function(e,t){return"object"==typeof e&&e.hasOwnProperty("aspectRatio")&&e.hasOwnProperty("geometry")&&"object"==typeof e.geometry&&e.geometry.hasOwnProperty("width")&&e.geometry.hasOwnProperty("height")&&e.geometry.hasOwnProperty("top")&&e.geometry.hasOwnProperty("left")&&e.hasOwnProperty("isAwake")}},photoUrl:{value:"/images/spaceball.gif",getter:function(e,t){var i,r=this.get("model"),a=this.get("layoutItem"),n={};return this.get("showInteractionBarPlaceholder")?(r.getValue("aspectRatio")>1?n.height=a.geometry.height-(this.get("interactionBarHeight")||0):n.width=a.geometry.width,i=r.getSizeToFit(n,{includeSquare:1===a.aspectRatio})):i=r.getSizeToFit({width:a.geometry.width,height:a.geometry.height},{includeSquare:1===a.aspectRatio}),i.url}},photoPageUrl:{writeOnce:!0,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},model:{value:null},listModelParams:{value:null},parentContainer:{writeOnce:"initOnly"},contextSuffix:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},measureAFT:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},isReallySleeping:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},isZombie:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},placeHolderHTML:{value:'<div class="youcansleepwhenyouredead" />',validator:function(t,i){return e.AttributeHelpers.validateString(t)}},showLowResImageFirst:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},interactionViewName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},showInteractionBarPlaceholder:{writeOnce:"initOnly",value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},interactionBarHeight:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)}},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},interactionView:{value:null},interactionContainer:{value:null,getter:function(e,t){return e||YUI.Env.isServer||(e=this.get("container").one(".interaction-view")),e}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-photo","url-helper","attribute-helpers"],optionalRequires:["fluid","storage-helper"],langBundles:["common"]});YUI.add("photo-list-view",function(t,e){"use strict";var i=require("hermes-core/flog")(e),o={containerWidth:"fullWidth",subtractScrollbarWidth:!1,pageParams:{page:1,perPage:50},parentName:"",subviewMapping:{"photo-models":{name:"photo-list-photo-view",params:null},"photo-lite-models":{name:"photo-list-photo-view",params:null},"set-models":{name:"photo-list-album-view",params:null}},paginateOnScroll:!0,keepAwakeOnScroll:!1,parentContainer:t.config.win,loadMoreMargin:3,relayoutOnResize:!0,recenterOnResize:!1,responsiveRowHeight:!1,maintainScrollPosition:!0,interactionViewName:"photo-list-photo-interaction-view",engagementModelName:"photo-engagement-models",itemFilterFunction:null,injectPhotolistContextParams:null,measureAFT:!1,beaconViews:!0,scrollInterruptParams:null,scrollToWithId:!1,handleCollectionChanged:!1},n={480:.5,800:.75,1280:1,1600:1.25},a=Object.keys(n);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var n,a=t.merge(o,e.photoListConfig);if(void 0===a)throw new Error("photo-list-view must be initialized with config params wrapped in a `photoListConfig` object.");if(a.initialItems)this.initialItems=a.initialItems.concat(),a.paginateOnScroll=!1;else{if(void 0===a.modelParams)throw new Error("photo-list-view must be initialized with `modelParams`.");if(void 0===a.modelParams.registryName)throw new Error("photo-list-view must be initialized with `modelParams.registryName`.");if(void 0===a.modelParams.modelIdOrAttributes)throw new Error("photo-list-view must be initialized with `modelParams.modelIdOrAttributes`.");if(void 0===a.modelParams.collectionAttributeName)throw new Error("photo-list-view must be initialized with `modelParams.collectionAttributeName`.")}if(void 0===a.parentName)throw new Error("photo-list-view must be initialized with the `parentName` (the name of the module containing the photolist).");return this.parentName=a.parentName,this.modelParams=a.modelParams,this.pageParams=a.pageParams,this.subviewMapping=a.subviewMapping,this.loadMoreMargin=a.loadMoreMargin,this.relayoutOnResize=a.relayoutOnResize,this.recenterOnResize=a.recenterOnResize,this.responsiveRowHeight=a.responsiveRowHeight,this.contextSuffix=a.contextSuffix,this.measureAFT=a.measureAFT,!YUI.Env.isServer&&a.beaconViews&&(this.viewBeaconer={beaconer:this.appContext.getViewCounter(),beaconAttribute:a.viewBeaconAttribute||"id",beaconRestrictedAttribute:a.viewBeaconRestrictedAttribute||"needsInterstitial",beaconAlwaysBeacon:a.viewBeaconAlwaysBeacon||!1,beaconIsOwnerAttribute:a.viewBeaconIsOwnerAttribute||"isOwner"}),a.subtractScrollbarWidth?YUI.Env.isServer?this.scrollbarWidth=this.appContext.viewportData.scrollbarWidth:this.scrollbarWidth=t.OverflowHelper.detectScrollbarSize(t.one("body")):this.scrollbarWidth=0,a.layout?(a.layout instanceof t.PhotoListLayout?(i.warn("Passing a PhotoListLayout instance into PhotoListView is deprecated. Instead, send the layout config object, and PhotoListView will create the PhotoListLayout for you."),this.photoListLayout=a.layout):(this.isMobile&&a.mobileLayout&&(0===Object.keys(a.mobileLayout).length&&(a.mobileLayout={targetRowHeight:200,containerPadding:{right:16,left:16},itemSpacing:{horizontal:16,vertical:16}}),a.layout.targetRowHeight=a.mobileLayout.targetRowHeight||a.layout.targetRowHeight,a.layout.containerPadding=t.merge(a.layout.containerPadding||{},a.mobileLayout.containerPadding||{}),a.layout.itemSpacing=t.merge(a.layout.itemSpacing||{},a.mobileLayout.itemSpacing||{})),this.photoListLayout=new t.PhotoListLayout(t.merge(a.layout,{appContext:this.appContext}))),delete a.layout.appContext):this.photoListLayout=new t.PhotoListLayout({appContext:this.appContext}),this.photoListLayout.containerWidth||(YUI.Env.isServer||(n=this.appContext.flapp.get("activeView")),this.appContext.hasClientSideRouted()&&n&&n.name===this.parentName?this.photoListLayout.containerWidth=this.calculateContainerWidth("previousContainerWidth"):(this.explicitContainerWidth=a.containerWidth,this.photoListLayout.containerWidth=this.calculateContainerWidth(this.explicitContainerWidth))),this.baseRowHeight=this.photoListLayout.targetRowHeight,this.responsiveRowHeight&&this.adjustRowHeightToContainerWidth(),this.paginateOnScroll=a.paginateOnScroll,this.paginateOnScroll&&this.photoListLayout.layout&&this.photoListLayout.hasLimitedNumberOfRows()&&i.warn("When photo-list-layout::maxNumRows is specified, photo-list::paginateOnScroll should probably be set to `false`."),this.parentContainer=a.parentContainer,this.keepAwakeOnScroll=a.keepAwakeOnScroll,this.keepAwakeOnScroll&&(this.photoListLayout.sleepTopAndBottom=!1),this.loadingMoreBottom=!1,this.loadingMoreTop=!1,this.lastItemCached=!1,this.firstItemCached=!1,this.itemsMappedToAspectRatios=[],this.lowestPageInView=this.pageParams.page,this.highestPageInView=this.pageParams.page,this.pageParams.viewPageSize&&(this.lastPageInView=this.pageParams.page+Math.ceil(this.pageParams.viewPageSize/this.pageParams.perPage)-1,isNaN(this.lastPageInView)&&i.warn("Error calculating `this.lastPageInView`. Verify values passed for `config.pageParams`.")),this.modelsById={},this.subviewsById={},this.fetchedOnlyInitPage=!1,this.perPageDoubles=0,this.interactionViewName=a.interactionViewName,this.showInteractionBarPlaceholder=a.showInteractionBarPlaceholder||!1,this.interactionBarHeight=a.interactionBarHeight,this.engagementModelName=a.engagementModelName,this.maintainScrollPosition=a.maintainScrollPosition,this.scrollToWithId=a.scrollToWithId,this.handleCollectionChanged=a.handleCollectionChanged,this.itemFilterFunction=a.itemFilterFunction,a.injectPhotolistContextParams&&(this.injectPhotolistContextParams=t.merge(a.injectPhotolistContextParams)),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.aftCache={},a.scrollInterruptParams&&(this.scrollInterruptParams=a.scrollInterruptParams,this.scrollInterruptState={nextInterrupt:this.scrollInterruptParams.pageCounts[0],numPagesLoaded:0,numInterrupts:0,isInterrupted:!1,footer:null,footerHeight:0}),delete e.photoListConfig,this.params=e,this},loadState:function(){var e,o,n=this;return this.initialItems?this.setItems(this.initialItems).then(this.loadStateSubviewsReady.bind(this),function(t){i.error("Error displaying initial items",{err:t})}):(e=t.merge(this.modelParams.fetchParams,this.pageParams),this.paginateOnScroll&&!this.scrollToWithId&&(e.page=2*(this.pageParams.page-1)+1,e.perPage=Math.floor(.5*this.pageParams.perPage),this.fetchedOnlyInitPage=!0),this.appContext.getModel(this.modelParams.registryName,this.modelParams.modelIdOrAttributes,e).then(function(i){var a,s=i.getValue(n.modelParams.collectionAttributeName),r=s.getList();if(n.set("collectionModel",i),n.lastPageInView)return(o=Math.min(s.getNextIncompletePage(n.pageParams),n.lastPageInView+1))<=n.pageParams.page?s.getPage(e):(a=s.getList().slice((n.pageParams.page-1)*n.pageParams.perPage,(o-1)*n.pageParams.perPage),t.Promise.resolve(a));var l=(e.page||1)*(e.perPage||0);return r.length&&(s.fetchedEnd||r.length>=l)?t.Promise.resolve(r):s.getPage(e)},function(t){i.error("error fetching model",{err:t})}).then(function(e){var i=n.get("collectionModel").getValue(n.modelParams.collectionAttributeName),a=i.getList(),s=i.getFirstItem(),r=i.getLastItem();return e&&e.length?(n.lastPageInView?(n.lowestPageInView=n.pageParams.page,o===n.lastPageInView?n.highestPageInView=o-(Math.floor(n.pageParams.viewPageSize/n.pageParams.perPage)-1):n.highestPageInView=Math.max(n.lowestPageInView,o)):(n.lowestPageInView=Math.floor(s.index/n.pageParams.perPage)+1,n.highestPageInView=Math.floor(r.index/n.pageParams.perPage)+1),!YUI.Env.isServer&&n.scrollInterruptState&&n.updateScrollInterruptState(n.highestPageInView-1),i.fetchedEnd&&e.length&&a.length&&e[e.length-1]&&a[a.length-1]&&e[e.length-1].id===a[a.length-1].id?n.lastItemCached=!0:n.highestPageInView>=n.lastPageInView&&(n.lastItemCached=!0),n.itemFilterFunction&&"function"==typeof n.itemFilterFunction&&(e=e.filter(n.itemFilterFunction)),n.layOutItems(e,"bottom")):t.Promise.resolve(null)},function(t){i.error("Calculate layout and generate subviews",{err:t})}).then(this.loadStateSubviewsReady.bind(this),function(t){i.warn("Error loading items from registry",{err:t,registry:n.modelParams.registryName,modelIdOrAttributes:n.modelParams.modelIdOrAttributes})}))},loadStateSubviewsReady:function(t){var e=0,i=this.photoListLayout.getAwakeItems().length;YUI.Env.isServer||(this.measureAFT&&this.appContext.hasClientSideRouted()&&t&&t.length&&t.forEach(function(t){t.once("loaded",function(o){this.aftCache[t.get("id")]=(new Date).getTime(),++e>=i&&this.reportAFTResults()}.bind(this))}.bind(this)),this.get("container").hasClass("requiredToShowOnServer")&&this.photoListLayout.containerWidth!==this.retrieveContainerWidth()&&(this._relayoutQueued=!0))},buildContainer:function(){return this.setContainerHTML(""),this.get("container").setStyle("height",this.containerHeight+"px"),this.initialLayoutResponse&&(this.renderSubviews(null,this.initialLayoutResponse),delete this.initialLayoutResponse),this},buildHeadContainer:function(){if(!YUI.Env.isServer)return this;var t,e,i=this;return this.measureAFT&&(t=Object.keys(this.subviewsById).map(function(t){return e=i.subviewsById[t],{id:t,url:e.get("photoUrl")}}),this.set("headContainer",this.templates("photo-list-aft")({photolistId:this.getAFTTimingKey(),photos:t}))),this},activate:function(){var e;return this._relayoutQueued&&(this._relayoutQueued=!1,this.initialLayoutResponse?(this.buildContainer(),this.storeContainerWidth(this.photoListLayout.containerWidth)):this.handleResize(null)),!this.paginateOnScroll&&this.keepAwakeOnScroll||(this.handleScroll(),this.parentContainer!==t.config.win&&this.parentContainer instanceof t.Node?this.registerEventHandler(this.parentContainer.on("scroll",this.handleScroll.bind(this))):this.registerEventHandler(t.globalEvents.subscribe("window:scroll",this.handleScroll.bind(this)))),this.relayoutOnResize&&this.registerEventHandler(t.globalEvents.subscribe("window:resize",this.handleResize.bind(this))),!YUI.Env.isServer&&this.maintainScrollPosition?this.photoListLayout.hasLimitedNumberOfRows()||(!(e=this.appContext.getReferrer())||e&&e!==this.appContext.flapp.getPath())&&this.restoreScrollPosition():!YUI.Env.isServer&&this.scrollToWithId&&this.scrollToId(this.scrollToWithId),this.injectPhotolistContextParams&&this.registerEventHandler(this.get("container").delegate("click",this.injectPhotolistContext.bind(this),"a")),this.registerEventHandler(this.get("container").delegate("click",this.subviewExtraToolClicked.bind(this),".extra-tool")),this.registerEventHandler(this.get("container").delegate("key",this.subviewExtraToolClicked.bind(this),"down:13",".extra-tool")),Object.keys(this.subviewMapping).some(function(t){return this.subviewMapping[t]&&"photo-list-tile-view"===this.subviewMapping[t].name}.bind(this))&&this.registerEventHandler(this.get("container").delegate("mouseenter",this.subviewLicenseMouseenter.bind(this),".license")),this.measureAFT&&this.reportAFTResults(),this.handleCollectionChanged&&this.registerEventHandler(this.get("collectionModel").on("valuesChanged",this.onCollectionModelValuesChanged.bind(this))),this.activateSubviews(),this},setItems:function(t){var e,i=this;return this.containerHeight=0,this.itemsMappedToAspectRatios=[],this.modelsById={},this.subviewsById={},this.get("collectionModel")&&((e=this.get("collectionModel").getValue(this.modelParams.collectionAttributeName)).fetchedStart?this.firstItemCached=!0:this.firstItemCached=!1,e.fetchedEnd?this.lastItemCached=!0:this.lastItemCached=!1),this.get("container").setHTML(""),this.photoListLayout.clear(),this.get("showThrobberDuringLoad")&&this.toggleThrobber(!0),this.layOutItems(t,"bottom").then(function(t){i.get("showThrobberDuringLoad")&&i.toggleThrobber(!1)})},getContainingElementData:function(){var e,i=this.get("container");return e={height:0,scrollLeft:0,scrollTop:0},e=this.parentContainer!==t.config.win&&this.parentContainer instanceof t.Node?{height:this.parentContainer.get("offsetHeight"),scrollLeft:this.parentContainer.getDOMNode().scrollLeft,scrollTop:this.parentContainer.getDOMNode().scrollTop}:{height:this.appContext.viewportData.getHeight(),scrollLeft:YUI.Env.isServer?0:t.config.win.pageXOffset,scrollTop:YUI.Env.isServer?0:t.config.win.pageYOffset},i&&(e.scrollLeft-=i.get("offsetLeft"),e.scrollTop-=i.get("offsetTop")),e},setContainerScrollTop:function(e){this.parentContainer!==t.config.win&&this.parentContainer instanceof t.Node?this.parentContainer.getDOMNode().scrollTop=e:t.config.win.scrollTo(0,e)},setTargetRowHeight:function(t){return this.photoListLayout.updateTargetRowHeight(t),this.handleResize(null,!0)},getSubview:function(t){return this.subviewsById[t]},handleScroll:function(e){var i,o=this,n=this.get("container"),a=n.get("clientHeight"),s=n.get("offsetParent").get("offsetTop")-n.get("offsetTop")+a,r=this.getContainingElementData(),l=r.height,h=r.scrollTop,c=h+l,u=!0;for(var d in this.subviewsById){u=!1;break}u||(!this.paginateOnScroll||this.scrollInterruptState&&this.scrollInterruptState.isInterrupted||((!this.lastPageInView||this.highestPageInView<this.lastPageInView)&&s-c<this.loadMoreMargin*l&&this.loadMore("bottom"),!this.lastPageInView&&h<this.loadMoreMargin*l&&this.lowestPageInView>1&&this.loadMore("top")),this.keepAwakeOnScroll||(i=this.photoListLayout.computeWakeSleep(r.scrollTop,r.scrollLeft),this.wakeOrSleepSubviews(i.wakeSleepChangedItems),!YUI.Env.isServer&&this.viewBeaconer&&i.inViewportChangedItems&&this.processInViewportItems(i.inViewportChangedItems)),void 0!==e&&(this.afterScrollTimeoutId&&t.config.win.clearTimeout(this.afterScrollTimeoutId),this.afterScrollTimeoutId=t.config.win.setTimeout(function(){o.paginateOnScroll&&o.storeScrollPosition(),o.paginateOnScroll&&!o.keepAwakeOnScroll&&o.validateWakeSleep(i),delete o.afterScrollTimeoutId},250)))},handleResize:function(t,e){this.responsiveRowHeight&&this.adjustRowHeightToContainerWidth();var i,o,n=this.calculateContainerWidth(),a=this.get("container"),s=this.getContainingElementData(),r={diffType:"relayout",firstPage:this.firstItemCached,lastPage:this.lastItemCached};if(e||n-this.scrollbarWidth!==this.photoListLayout.containerWidth)return this.storeContainerWidth(n),this.photoListLayout.containerWidth=n-this.scrollbarWidth,i=this.photoListLayout.computeLayout(null,s.scrollTop,s.scrollLeft,r),this.containerHeight=i.containerHeight,this.scrollInterruptState&&this.scrollInterruptState.isInterrupted&&this.scrollInterruptState.loadMoreElement&&this.scrollInterruptState.loadMoreElement.setStyle("width",this.photoListLayout.containerWidth+"px"),a.setStyle("height",i.containerHeight+"px"),o=this.updateSubviews(i,"bottom"),this.recenterOnResize&&this.scrollToCenterItem(i.allLayoutItems),o},loadMore:function(e){"search-photos-lite-models"===this.modelParams.registryName&&this.modelParams.fetchParams&&this.modelParams.fetchParams.apiParams&&void 0!==this.modelParams.fetchParams.apiParams.page&&delete this.modelParams.fetchParams.apiParams.page;var o=this,n=this.get("collectionModel").getValue(this.modelParams.collectionAttributeName),a=n.getList(),s=t.merge(this.modelParams.fetchParams,this.pageParams);if("bottom"!==e||this.loadingMoreBottom)"top"!==e||this.loadingMoreTop||(s.page=this.lowestPageInView-1,o.lowestPageInView>1&&(this.loadingMoreTop=!0,n.getPage(s).then(function(t){n.fetchedStart&&t[0].id===n.getList()[0].id&&(o.firstItemCached=!0),o.lowestPageInView=o.lowestPageInView-1,o.layOutItems(t,e).then(function(t){o.loadingMoreTop=!1,o.paginateOnScroll&&(s.page<=0?i.warn("loadMore fetching beyond start of collection; aborting",{params:s}):o.handleScroll())})},function(t){i.error("loadMore page fetch failed",{err:t}),o.toggleThrobber(!1)})));else{if(this.fetchedOnlyInitPage?(s.page=2*(this.pageParams.page-1)+2,s.perPage=Math.floor(.5*this.pageParams.perPage)):s.page=this.highestPageInView+1,n.fetchedEnd&&this.lastItemCached)return;this.loadingMoreBottom=!0,this.scrollInterruptParams&&this.scrollInterruptParams.footerToHideWhileScrolling&&!this.scrollInterruptState.footer&&(this.scrollInterruptState.footer=t.one(this.scrollInterruptParams.footerToHideWhileScrolling),this.scrollInterruptState.footer&&(this.scrollInterruptState.footerHeight=this.scrollInterruptState.footer.get("clientHeight"),this.setFooterDisplay(!1))),this.get("showThrobberDuringLoad")&&this.toggleThrobber(!0),n.getPage(s).then(function(t){a=n.getList(),n.fetchedEnd&&t[t.length-1].id===a[a.length-1].id&&(o.lastItemCached=!0),o.fetchedOnlyInitPage?o.fetchedOnlyInitPage=!1:(s.perPageDoubling&&o.perPageDoubles<s.perPageDoubling&&(o.perPageDoubles++,o.pageParams.perPage*=2,o.highestPageInView=Math.floor(.5*o.highestPageInView),o.lastPageInView=Math.floor(.5*o.lastPageInView)),o.highestPageInView=o.highestPageInView+1),o.highestPageInView>=o.lastPageInView&&(o.lastItemCached=!0),o.itemFilterFunction&&"function"==typeof o.itemFilterFunction&&(t=t.filter(o.itemFilterFunction)),o.layOutItems(t,e).then(function(t){o.loadingMoreBottom=!1,o.paginateOnScroll&&(n.totalItems&&(s.page-1)*s.perPage>n.totalItems?i.warn("loadMore fetching beyond end of collection; aborting",{params:s,total:n.totalItems}):o.handleScroll())}),o.scrollInterruptState&&(o.lastItemCached?o.setFooterDisplay(!0):(o.scrollInterruptState.numPagesLoaded++,o.checkScrollInterruptionState())),o.get("showThrobberDuringLoad")&&o.toggleThrobber(!1)},function(t){i.error("loadMore page fetch failed",{err:t}),o.toggleThrobber(!1)})}},layOutItems:function(e,o,n){if(!e||!e.length)return t.Promise.resolve();var a,s,r,l=this.containerHeight,h={},c=this.get("container"),u=this.getContainingElementData();if(e=this.cacheModelsById(e),a=this.itemsToAspectRatios(e),"bottom"===o)this.itemsMappedToAspectRatios=this.itemsMappedToAspectRatios.concat(a),s=a,h.diffType="append",this.lastItemCached&&(h.lastPage=!0);else{if("top"!==o)return void i.warn("Unsupported `layOutItems` direction",{direction:o});this.itemsMappedToAspectRatios=a.concat(this.itemsMappedToAspectRatios),s=a,h.diffType="prepend",this.firstItemCached&&(h.firstPage=!0)}return n&&(h.diffType="relayout",h.diffDirection=o),r=this.photoListLayout.computeLayout(s,u.scrollTop,u.scrollLeft,h),c.setStyle("height",r.containerHeight+"px"),this.containerHeight=r.containerHeight,"top"===o&&this.setContainerScrollTop(this.containerHeight-l),this.updateSubviews(r,o)},updateSubviews:function(t,e){var o,n=this;return this.instantiateSubviews(t.newItems).then(function(i){return i=i.filter(function(t){return!!t}),n.updateSubviewGeometry(t.layoutChangedItems),n.isBuilt?(n.renderSubviews(i,t,e),n.activateSubviews(i),t.wakeSleepChangedItems.length&&(o=t.wakeSleepChangedItems.filter(function(e){return-1===t.newItems.indexOf(e)})).length&&n.wakeOrSleepSubviews(o),t.inViewportChangedItems.length&&n.processInViewportItems(t.inViewportChangedItems)):n.initialLayoutResponse=t,i},function(t){i.error("Error instantiating subviews",{err:t})})},instantiateSubviews:function(e){var o,n=[],a=this,s=this.get("container");e.forEach(function(e){(o=a.modelsById[e.id])?a.subviewsById[e.id]?n.push(t.Promise.resolve(a.subviewsById[e.id])):n.push((function(o,n){var r=t.merge(a.params,{id:e.id,parentSignature:a.getPhotolistSignature(),model:o,contextSuffix:a.contextSuffix,layoutItem:n,parentContainer:s,interactionViewName:a.interactionViewName,showInteractionBarPlaceholder:a.showInteractionBarPlaceholder,interactionBarHeight:a.interactionBarHeight,engagementModelName:a.engagementModelName,measureAFT:a.measureAFT}),l=a.subviewMapping[o.registry.name];return l.params&&(r=t.merge(r,l.params)).removePoolPhoto&&(r.listModelParams=a.modelParams),a.instantiateSubview(l.name,r).then(function(t){return t.initialize().then(function(t){return a.subviewsById[n.id]=t,a.subviews={},t},function(t){return i.warn("Error in lifecycle of subview",{err:t,view:l.name}),a.photoListLayout.invalidateItem(n.id),null})},function(t){i.warn("Error instantiating subview",{err:t,view:l.name})})})(o,e)):i.warn("Model missing from cache",{modelId:e.id})});var r=t.Promise.all(n);return r.then(function(t){return!YUI.Env.isServer&&a.viewBeaconer&&a.viewBeaconer.beaconer.flushQueue({avoidDuplicates:!0}),t}),r},renderSubviews:function(t,e,o){var n,a,s,r,l=this.get("container"),h=this;t||(t=[],e.allLayoutItems.forEach(function(e){var i=h.subviewsById[e.id];i&&t.push(i)})),o||(o="bottom"),YUI.Env.isServer?(n=t.map(function(t){return t.get("container").get("outerHTML")}),"top"===o?l.setHTML(n.join("")+l.getHTML()):"bottom"===o?l.setHTML(l.getHTML()+n.join("")):(i.warn("Unsupported `renderSubviews` direction; appending changed subviews.",{direction:o}),l.setHTML(l.getHTML()+n.join("")))):("top"===o&&t.reverse(),a=YUI.config.doc.createDocumentFragment(),t.forEach(function(t){t&&a.appendChild(t.get("container").getDOMNode())}),"top"===o?l.prepend(a):"bottom"===o?l.append(a):(i.warn("Unsupported `renderSubviews` direction; appending changed subviews.",{direction:o}),l.append(a))),s=e.wakeSleepChangedItems.filter(function(t){return-1!==e.newItems.indexOf(t)}),this.updateSubviewGeometry(s),this.keepAwakeOnScroll?(r=e.wakeSleepChangedItems.filter(function(t){return-1!==e.leadingOrphans.indexOf(t)||-1!==e.trailingOrphans.indexOf(t)}),s.forEach(function(t){t.isAwake=!0}),this.wakeOrSleepSubviews(s.concat(r))):this.wakeOrSleepSubviews(e.wakeSleepChangedItems)},updateSubviewGeometry:function(t){var e,o=this;t.forEach(function(t){(e=o.subviewsById[t.id])?e.updateGeometry?e.updateGeometry(t):e.get("container").setStyles({width:t.geometry.width+"px",height:t.geometry.height+"px",transform:"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-webkit-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-ms-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)"}):i.warn("Subview missing from cache for geometry update",{layoutItemId:t.id})})},wakeOrSleepSubviews:function(t){var e,o=this;t.forEach(function(t){(e=o.subviewsById[t.id])?e.wake&&e.sleep?t.isAwake?e.wake():e.sleep():e.get("container").setStyle("display",t.isAwake?"":"none"):i.warn("Subview missing from cache for wake/sleep update",{layoutItemId:t.id})})},processInViewportItems:function(e){var i,o=this;e.forEach(function(e){if(e.isInViewport){if(!(i=o.subviewsById[e.id]))return;!YUI.Env.isServer&&o.viewBeaconer&&o.viewBeaconer.beaconer&&i.get("model").registry.hasAttribute(o.viewBeaconer.beaconIsOwnerAttribute)&&!i.get("model").getValue(o.viewBeaconer.beaconIsOwnerAttribute)&&(o.viewBeaconer.beaconAlwaysBeacon||i.get("model").registry.hasAttribute(o.viewBeaconer.beaconRestrictedAttribute)&&!i.get("model").getValue(o.viewBeaconer.beaconRestrictedAttribute))&&o.viewBeaconer.beaconer.queue(i.get("model").getValue(o.viewBeaconer.beaconAttribute),t.config.win.document.location.href)}})},activateSubviews:function(t){if(!t){t=[];for(var e in this.subviewsById)t.push(this.subviewsById[e])}t.forEach(function(t){t.normalizedActivate()})},removeItems:function(t){var e=this;t.forEach(function(t){e.photoListLayout.invalidateItem(t.id),e.itemsMappedToAspectRatios=e.itemsMappedToAspectRatios.filter(function(e){return e.id!==t.id}),e.modelsById[t.id]&&delete e.modelsById[t.id],e.subviewsById[t.id]&&(e.subviewsById[t.id].destroy({remove:!0}),delete e.subviewsById[t.id])})},onCollectionModelValuesChanged:function(t,e){var i,o,n,a,s;if(t[this.modelParams.collectionAttributeName]&&t[this.modelParams.collectionAttributeName].listDiff&&(i=t[this.modelParams.collectionAttributeName].listDiff,!this.loadingMoreBottom&&!this.loadingMoreTop)){if(o=this.get("collectionModel").getValue(this.modelParams.collectionAttributeName),n=o.getList(),i.added.length){var r,l,h,c;a=i.added,-1!==(r=n.indexOf(a[0])-1)&&(l=n[r])&&this.modelsById[l.id]&&(s="bottom",o.fetchedEnd&&a[a.length-1].id===n[a.length-1].id&&(this.lastItemCached=!0)),-1!==(h=n.indexOf(a[a.length-1])+1)&&(c=n[h+1])&&this.modelsById[c.id]&&(s="top",o.fetchedStart&&a[0].id===n[0].id&&(this.firstItemCached=!0)),s&&this.layOutItems(a,s,e)}i.removed.length&&(this.removeItems(i.removed),this.handleResize(null,!0))}},toggleThrobber:function(t){var e=this.get("container");void 0===t&&(t=!this.get("isThrobberShowing")),t?(e.setStyle("height",this.containerHeight+100+"px"),this.get("throbberNode").appendTo(e)):this.get("throbberNode").remove(),this._set("isThrobberShowing",t)},checkScrollInterruptionState:function(t){if(this.scrollInterruptState||t){var e;if(this.scrollInterruptState.numPagesLoaded>=this.scrollInterruptState.nextInterrupt){if(this.scrollInterruptState.numInterrupts++,e=this.scrollInterruptParams.pageCounts[this.scrollInterruptParams.pageCounts.length-1],this.scrollInterruptState.numInterrupts>=this.scrollInterruptParams.pageCounts.length)switch(this.scrollInterruptParams.repeatMode){case"exponential":this.scrollInterruptState.nextInterrupt+=e*Math.pow(2,this.scrollInterruptState.numInterrupts-this.scrollInterruptParams.pageCounts.length);break;case"linear":default:this.scrollInterruptState.nextInterrupt+=e}else this.scrollInterruptState.nextInterrupt+=this.scrollInterruptParams.pageCounts[this.scrollInterruptState.numInterrupts];t||this.interruptScroll()}else this.get("container").setStyle("paddingBottom","0px")}},updateScrollInterruptState:function(t){this.scrollInterruptState.numPagesLoaded=t;for(var e=0;e<=t;e++)this.checkScrollInterruptionState(!0)},interruptScroll:function(){this.scrollInterruptState.isInterrupted||(this.scrollInterruptState.isInterrupted=!0,this.scrollInterruptState.loadMoreElement||(this.scrollInterruptState.loadMoreElement=t.Node.create(this.templates("infinite-scroll-load-more")({}))),this.get("container").append(this.scrollInterruptState.loadMoreElement),this.scrollInterruptState.loadMoreElementHeight||(this.scrollInterruptState.loadMoreElementHeight=parseInt(this.scrollInterruptState.loadMoreElement.getComputedStyle("height").replace("px",""),10)+20,this.registerEventHandler(this.scrollInterruptState.loadMoreElement.on("click",this.onLoadMoreClicked.bind(this))),this.scrollInterruptState.loadMoreElement.setStyles({width:this.photoListLayout.containerWidth+"px",bottom:this.photoListLayout.containerPadding.bottom+"px"})),this.setFooterDisplay(!0),this.get("container").setStyle("paddingBottom",this.scrollInterruptState.loadMoreElementHeight+"px"))},onLoadMoreClicked:function(e){var i,o=t.config.win.pageYOffset;this.scrollInterruptState.isInterrupted&&(this.scrollInterruptState.isInterrupted=!1,this.scrollInterruptState.loadMoreElement.remove(),this.setFooterDisplay(!1),this.get("container").setStyle("paddingBottom",this.scrollInterruptState.footerHeight+this.scrollInterruptState.loadMoreElementHeight-100+"px"),this.loadMore("bottom"),i=t.config.win.pageYOffset,t.config.win.scrollBy(0,o-i))},setFooterDisplay:function(t){this.scrollInterruptState.footer&&(t?this.scrollInterruptState.footer.removeClass("infinite-scroll-hide-footer"):this.scrollInterruptState.footer.addClass("infinite-scroll-hide-footer"),this.fire("subviewViewEvent","footerDisplayChanged"))},cacheModelsById:function(t){if(t&&t.length){var e=this.modelsById,i=[];return t.forEach(function(t){t&&!e[t.id]&&(e[t.id]=t,i.push(t))}),i}},itemsToAspectRatios:function(t){var e=[],i=this.photoListLayout.forceAspectRatio,o=void 0!==i&&!isNaN(i),n=i||1;return t.forEach(function(t){void 0!==t&&e.push({id:t.id,aspectRatio:o?n:t.getValue("aspectRatio")})}),e},calculateContainerWidth:function(e){if(e||(e=this.explicitContainerWidth),"number"==typeof e)return e;var i,o;switch(e){case"previousContainerWidth":o=this.getContainerWidthFromCache();break;case"fullWidth":default:YUI.Env.isServer||(this.isActiveAndInDOM()?o=this.get("container").get("clientWidth")-this.scrollbarWidth:(i=this.get("container"),this.isBuilt&&i||(i=t.one("."+this.parentName)),i&&(o=parseInt(i.getStyle("width"))))),o||(o=this.getContainerWidthFromCache())}return o},getContainerWidthFromCache:function(){var t;return(t=this.retrieveContainerWidth())||(t=this.appContext.viewportData.getWidth()-this.scrollbarWidth),this._relayoutQueued=!0,t},adjustRowHeightToContainerWidth:function(t){var e,i,o,s,r;if((t=this.calculateContainerWidth(t))<a[0])i=this.baseRowHeight*n[a[0]];else if(t>a[a.length-1])i=this.baseRowHeight*n[a[a.length-1]];else for(r=0;r<a.length-1;r++)if(o=a[r],s=a[r+1],(e=(t-o)/(s-o))>=0&&e<=1){i=this.baseRowHeight*n[o]+e*this.baseRowHeight*(n[s]-n[o]);break}this.photoListLayout.targetRowHeight=i},storeContainerWidth:function(t){var e=this.parentName;e&&this.appContext.viewportData.setContainerWidth(e,t)},retrieveContainerWidth:function(){var t=this.parentName;return t?this.appContext.viewportData.getContainerWidth(t):0},getLayoutItemsOnScreen:function(t){if(YUI.Env.isServer)return[];var e,i,o=this.get("container"),n=this.getContainingElementData();return e=n.scrollTop-o.getXY()[1],i=e+n.height,t||(t=this.photoListLayout.getCurrentLayout())?t.filter(function(t){return t.geometry.top+t.geometry.height>e&&t.geometry.top<i}):[]},scrollToCenterItem:function(e){if(!this.photoListLayout.hasLimitedNumberOfRows()&&0!==this.getContainingElementData().scrollTop){var i,o=this.photoListLayout.getCurrentLayout(),n=this.get("container").getXY()[1],a=this;this.layoutItemAtScreenCenter||(i=this.getLayoutItemsOnScreen(o),this.layoutItemAtScreenCenter=i[Math.floor(.5*i.length)]),e.some(function(e){if(e.id===a.layoutItemAtScreenCenter.id)return a.parentContainer!==t.config.win&&a.parentContainer instanceof t.Node?a.parentContainer.getDOMNode().scrollTop=n+e.geometry.top+.5*(e.geometry.height-a.parentContainer.get("offsetHeight")):t.config.win.scrollTo(0,n+e.geometry.top+.5*(e.geometry.height-a.appContext.viewportData.getHeight())),!0}),this.deleteResizeCenterTimeoutId&&t.config.win.clearTimeout(this.deleteResizeCenterTimeoutId),this.deleteResizeCenterTimeoutId=t.config.win.setTimeout(function(){a.layoutItemAtScreenCenter&&(delete a.layoutItemAtScreenCenter,delete a.deleteResizeCenterTimeoutId)},1e3)}},storeScrollPosition:function(){
var e=this.getLayoutItemsOnScreen();e.length&&t.StorageHelper.setItem(this.getPhotolistSignature(),e[0].id,!0)},restoreScrollPosition:function(){this.scrollToId(null,!0)},scrollToId:function(e,i){var o,n,a=this.get("container");e||(e=t.StorageHelper.getItem(this.getPhotolistSignature(),!0)),(o=this.photoListLayout.getLayoutItem(e))&&(!o.geometry||o.geometry.top-this.photoListLayout.containerPadding.top<=0||(n=a.get("offsetParent")?a.get("offsetParent").get("offsetTop")+a.get("offsetTop"):a.get("offsetTop"),t.one(".global-nav-view")&&!i&&(n-=t.one(".global-nav-view").get("offsetHeight")),t.one(".fluid-subnav")&&!i&&(n-=t.one(".fluid-subnav").get("offsetHeight")),i&&(n+=50),this.setContainerScrollTop(o.geometry.top+n)))},validateWakeSleep:function(t){var e,i,o,n,a=this.photoListLayout.getAwakeItems(),s=t.allLayoutItems.indexOf(a[0]),r=t.allLayoutItems.indexOf(a[a.length-1]),l=[];for(e=s;e<r;e++)i=t.allLayoutItems[e],(o=this.subviewsById[i.id])&&((n=!i.isAwake)||(n=o.isAwake?!o.isAwake():0===o.get("container").get("children").size()),n&&i&&(i.isAwake=!0,l.push(i)));l.length&&this.wakeOrSleepSubviews(l)},getPhotolistSignature:function(){var e,i,o,n=0;if(!this.signature){if(YUI.Env.isServer){if(e=this.appContext.request.path,this.appContext.request.query)for(i in this.appContext.request.query)t.config.flickr.routing_params.indexOf(i)<0&&(e+=i+this.appContext.request.query[i])}else e=t.config.win.location.pathname+decodeURIComponent(t.config.win.location.search);if(e=t.flutil.normalizeURIComponents(e),this.modelParams)if("string"!=typeof this.modelParams.modelIdOrAttributes)for(i in this.modelParams.modelIdOrAttributes)e+=i+""+this.modelParams.modelIdOrAttributes[i];else e+=this.modelParams.modelIdOrAttributes;for(this.parentName&&(e+=this.parentName),e=(e=e.toLowerCase()).replace(/\W/g,""),o=0;o<e.length;o++)n+=e.charCodeAt(o);this.signature="photolist-"+n.toString(36)}return this.signature},injectPhotolistContext:function(e){var o,n,a,s,r,l,h,c,u=e.currentTarget.getAttribute("href"),d=t.URLHelper.PHOTOPAGE_PATTERN.exec(u),g="";if(d&&d.length>=5){if(o=this.get("collectionModel").getValue(this.modelParams.collectionAttributeName).getList().map(function(t){return t.id}).filter(function(t){return!!t}),s=d[4],-1===(r=o.indexOf(s)))return void i.warn("Clicked photo id not found in photolist. Aborting photolist injection and passing through to photopage.");(n=o.slice(r,r+50)).length<50&&(a=Math.max(0,r-(50-n.length)),n=o.slice(a,r).concat(n)),u.indexOf("#")>-1&&(u=(c=u.split("#"))[0],g="#"+c[1]),"/"===u.substr(-1)&&(u=u.substr(0,u.length-1)),l=u+"/in/photolist-"+t.URLHelper.generateShortenedPhotolist(n)+g,e.halt(),this.injectPhotolistContextParams&&this.injectPhotolistContextParams.rapidBeaconConfig&&((h={})[this.injectPhotolistContextParams.rapidBeaconConfig.itemIndexKey]=r+1,t.rapidTracker.beacon(this.name,this.injectPhotolistContextParams.rapidBeaconConfig.beaconName,h)),e.metaKey||e.ctrlKey||e.which&&2===e.which?t.config.win.open(l,"_blank"):this.appContext.flapp.navigate(l)}},subviewExtraToolClicked:function(e){var i,o=e.target.getDOMNode(),n=o.dataset.id,a=this.modelsById[n];if(n&&a){if(o.classList.contains("more-menu")){var s=[],r=o.dataset.menuItems.split(",");r&&(r.indexOf("search-similar")>-1&&s.push({text:this.intlMessage({intlName:"common.SEARCH_FOR_SIMILAR_PHOTOS"}),callback:function(e,i){var o=a.getValue("similaritySearchURL");i.metaKey||i.ctrlKey||i.which&&2===i.which?t.config.win.open(o,"_blank"):this.appContext.flapp.navigate(o)}.bind(this)}),r.indexOf("search-similar-with-term")>-1&&"search-photos-lite-models"===this.modelParams.registryName&&this.modelParams.fetchParams&&this.modelParams.fetchParams.apiParams&&this.modelParams.fetchParams.apiParams.text&&s.push({text:this.intlMessage({intlName:"common.SEARCH_FOR_SIMILAR_PHOTOS_WITH_TERM"}),callback:function(e,i){var o=a.getValue("basicSimilaritySearchURL")+"&text="+this.modelParams.fetchParams.apiParams.text;i.metaKey||i.ctrlKey||i.which&&2===i.which?t.config.win.open(o,"_blank"):this.appContext.flapp.navigate(o)}.bind(this)}),r.indexOf("exclude-people")>-1&&s.push({text:this.intlMessage({intlName:"common.HIDE_PHOTOS_FROM_PERSON"}),callback:function(){this.fire("subviewViewEvent","bigScotch",a.getValue("ownerNsid"),n)}.bind(this)}),r.indexOf("ban-user")>-1&&(i=function(t){this.fire("subviewViewEvent","banUser"+(t?"AndRemove":""),a.getValue("owner").id)},s.push({text:this.intlMessage({intlName:"common.GROUP_BAN_USER"}),callback:i.bind(this,!1)}),s.push({text:this.intlMessage({intlName:"common.GROUP_BAN_USER_REMOVE_PHOTOS"}),callback:i.bind(this,!0)})),r.indexOf("remove-user")>-1&&(i=function(t){this.fire("subviewViewEvent","removeUser"+(t?"AndRemove":""),a.getValue("owner").id)},s.push({text:this.intlMessage({intlName:"common.GROUP_REMOVE_USER"}),callback:i.bind(this,!1)}),s.push({text:this.intlMessage({intlName:"common.GROUP_REMOVE_USER_REMOVE_PHOTOS"}),callback:i.bind(this,!0)}))),s.length&&this.openSubviewMenu(e.target,s,this.subviewsById[n])}else o.classList.contains("remove-photo")?(this.fire("subviewViewEvent","photoList:removePhoto",n),o.classList.contains("remove-fave")?this.appContext.getModelRegistry(this.engagementModelName).then(function(e){return e.remoteDelete({photoId:n,userId:this.modelParams.modelIdOrAttributes.id||this.modelParams.modelIdOrAttributes}).then(function(t){this.get("collectionModel").getValue(this.modelParams.collectionAttributeName).remove(a)}.bind(this),function(e){new t.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),showActionButton:!0,showCancelButton:!1,textMessage:this.intlMessage({intlName:"common.PHOTO_REMOVE_ERROR"})}).show()}.bind(this))}.bind(this)):o.classList.contains("remove-group-pool")?this.get("collectionModel").removePhotoRemote(n).then(function(t){this.get("collectionModel").getValue(this.modelParams.collectionAttributeName).remove(a)}.bind(this),function(e){new t.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),showActionButton:!0,showCancelButton:!1,textMessage:this.intlMessage({intlName:"common.PHOTO_REMOVE_ERROR"})}).show()}.bind(this)):o.classList.contains("remove-showcase-photo")?this.fire("subviewViewEvent","showcase:remove",a,n):o.classList.contains("remove-photosof-you")?this.fire("subviewViewEvent","photosofyou:remove",a,n):o.classList.contains("remove-own-photo")&&this.fire("subviewViewEvent","ownphoto:remove",a,n)):o.classList.contains("big-scotch")&&this.fire("subviewViewEvent","scotch:big",a.getValue("ownerNsid"),n);e.halt()}},openSubviewMenu:function(e,i,o){var n,a,s,r,l,h=new t.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:e,positionFixed:!1,preferBottom:!0,dismissOnOverlayClick:!0,closeOnScroll:!0,mirrorArrowAdjustment:-3,menuItems:i}),c=this;this.registerEventHandler(h.on("selected",function(t){t&&t.menuItem&&t.menuItem.callback&&t.menuItem.callback(t.menuItem.selected,t.origEvent)})),l=h.on("closeDroparound",function(t){c.detachRegisteredEvent(l),c.detachRegisteredEvent(n),c.detachRegisteredEvent(a),s&&clearTimeout(s),o.setHoverVisible&&o.setHoverVisible(!1)}),this.registerEventHandler(l),h.show(),n=h.get("container").on("mouseleave",function(t){if(h){var e=o.get("container");if(e){var i=e.getDOMNode().getBoundingClientRect();(t.clientX<i.left||t.clientX>i.right||t.clientY<i.top||t.clientY>i.bottom)&&h.close()}}}),this.registerEventHandler(n),a=t.one("document").on("mousemove",t.betterThrottle(function(t){s&&clearTimeout(s),s=setTimeout(function(){r(t)},200)})),this.registerEventHandler(a),r=function(t){if(h){var e=h.getDroparoundContainer(),i=o.get("container");if(i&&e){var n=i.getDOMNode().getBoundingClientRect(),a=e.getDOMNode().getBoundingClientRect();!(t.clientX<n.left||t.clientX>n.right||t.clientY<n.top||t.clientY>n.bottom)||t.clientX>a.left&&t.clientX<a.right&&t.clientY>a.top&&t.clientY<a.bottom||h.close()}}},o.setHoverVisible&&o.setHoverVisible(!0)},subviewLicenseMouseenter:function(e){var i,o=e.currentTarget&&e.currentTarget.getData("license-type")&&e.currentTarget.getData("license-type").toString();o&&(this.licenseTooltipHoverTimer&&clearTimeout(this.licenseTooltipHoverTimer),this.licenseTooltip&&this.licenseTooltip.close(),this.licenseTooltipHoverTimer=setTimeout(function(){this.licenseTooltip=new t.Views.FluidDroparound({appContext:this.appContext,anchorElement:e.target,showDropArrow:!0,positionFixed:!1,preferBottom:!0,invisibleOverlay:!0,autoSizeToContent:!0,width:300,classList:"license-tooltip",htmlMessage:this.templates("license-detail")({title:"common.LICENSE_TITLE_"+o,body:"common.LICENSE_DESC_"+o})}),this.licenseTooltip.show()}.bind(this),300),i=this.get("container").delegate("mouseleave",function(t){this.licenseTooltip&&this.licenseTooltip.close(),i.detach(),clearTimeout(this.licenseTooltipHoverTimer)}.bind(this),".license"),this.registerEventHandler(i))},reportAFTResults:function(){var t,e,i=0;if(this.appContext.hasClientSideRouted())t=this.aftCache;else{if(!window.paftTiming)return;t=window.paftTiming[this.getAFTTimingKey()]}for(e in t)this.photoIsAboveTheFold(e)&&(i=Math.max(i,t[e]));this.fire("subviewViewEvent","atfVisible",i,this.getAFTTimingKey())},getAFTTimingKey:function(){return this.parentName||this.getPhotolistSignature()},photoIsAboveTheFold:function(t){if(YUI.Env.isServer)return!0;var e=this.subviewsById[t];return!!e&&e.get("container").getXY()[1]<this.getContainingElementData().height}},{ATTRS:{showThrobberDuringLoad:{value:!0,validator:function(e,i){return t.AttributeHelpers.validateBoolean(e)}},isThrobberShowing:{readOnly:!0,value:!1},throbberNode:{readOnly:!0,getter:function(e){return YUI.Env.isServer||void 0!==e||(e=t.Node.create('<div style="position: absolute; bottom: 40px; left: 0; right: 0;"><div class="flickr-dots"></div></div>'),this._set("throbberNode",e)),e}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-aft","hermes-template-infinite-scroll-load-more","hermes-template-license-detail","photo-list-layout","photo-list-photo-view","overflow-helper","storage-helper","attribute-helpers","url-helper","paged-collection","fluid-droparound-view"],optionalRequires:["global-events"],langBundles:["common"]});