YUI.add("flickr-favorites-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-favorites-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.favorites.getContext",this._processParams(t),!0),s.getModelRegistry("favorite-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 3===e.code&&"Photo not a favorite"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){var t={photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()};return o.id?t.user_id=o.id:t.path_alias=o.pathAlias,t},_processResponse:function(o,t){var s,r,n,a,p,i,l=o[0],h=o[1],d=o[2],g=o[3],u=o[4],m=o[5],c=[],x=[],y=d.proxy(t.photoId),M=[];return s=l.prevphotos,r=l.nextphotos,x=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:g,photoModelRegistry:d,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:g,photoModelRegistry:d,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),i=h.getValue(t.id,"photoContextList"),a=!!i.hasMinBoundary&&i.hasMinBoundary(),p=!!i.hasMaxBoundary&&i.hasMaxBoundary(),n=i.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:y,next:x,prev:c.reverse(),hasMax:p,hasMin:a,current:n,numNext:t.numNext,numPrev:t.numPrev}),h.setValue(t.id,"photoContextList",M),{next:x,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["favorite-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-favorites-getList-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-favorites-getList"]={run:function(o,s){var r=this;return e.Promise.all([s.callAPI("flickr.favorites.getList",this._processParams(o)),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("favorite-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,o)},e.FetcherErrorLogger(t))},_processParams:function(t){var o={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||20,page:t.page||1,get_user_info:1,jump_to:t.withPhotoId||""};if(t.id||t.userId)o.user_id=(t.id||t.userId).split("-")[0];else{if(!t.pathAlias)throw new Error("[flickr-favorites-getList-fetcher] `id` or `pathAlias` is required.");o.path_alias=t.pathAlias}return o},_processResponse:function(t,o){var s,r,a=t[0],i=t[1],p=t[2],l=t[3],d=t[4],g=t[5],n={id:a.user.nsid,pathAlias:a.user.pathAlias,totalItems:a.photos.total},h=o.id||o.userId;return h&&h!==n.id&&(n.id=h),r=e.APIHelper.response.parsePerson(a.user),n.owner=p.addOrUpdate(r),s=e.APIHelper.response.parsePhotos({photos:a.photos.photo,personModelRegistry:p,photoModelRegistry:i,photoEngagementModelRegistry:d,photoStatsModelRegistry:g}),n.photoPageList={perPage:a.photos.perpage,page:a.photos.page,pageContent:s,totalItems:a.photos.total},l.addOrUpdate(n),s}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","favorite-models","photo-engagement-models","photo-stats-models"]});YUI.add("favorite-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-favorites-getList"].run(t,this.appContext)}},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"favorites"}},title:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t,r=this.appContext.getViewer(),i=this.getValue(e,"normalizedId");return r&&r.nsid===i?"Your favorites":(t=this.getValue(e,"owner"))?t.getValue("displayname")+"'s favorites":"Favorites"}},pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return this.getValue(e,"normalizedId")}},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-favorites-getList"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-favorites-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),r=this.getValue(e,"normalizedId");return"/photos/"+(t?t.getValue("pathAlias"):r)+"/favorites/"}},totalItems:{defaultFn:function(){return null}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){return"faves-"+this.getValue(e,"owner").getValue("pathAlias")}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-favorites-getContext-fetcher","flickr-favorites-getList-fetcher","photo-model-helper"]});YUI.add("flickr-galleries-getInfo-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-galleries-getInfo"]={run:function(o,t){var n=this,s=this._processParams(o);return e.FlickrPromise({apiResponse:t.callAPI("flickr.galleries.getInfo",s),galleryInfoModelRegistry:t.getModelRegistry("gallery-info-models"),personModelRegistry:t.getModelRegistry("person-models")}).then(function(e){return n._processResponse(e,o,t)},e.FetcherErrorLogger(r))},_processResponse:function(e,r,o){var t,n,s=e.apiResponse,i=e.galleryInfoModelRegistry,a=(e.personModelRegistry,e.personModel,s.gallery);if(a)return o.getModel("person-models",a.owner).then(function(e){return n=e,t={id:r.id,compoundId:a.id,owner:n,username:a.username,primaryPhotoId:a.primary_photo_id,dateCreate:parseInt(a.date_create),dateUpdate:parseInt(a.date_update),photoCount:a.count_photos,videoCount:a.count_videos,viewCount:parseInt(a.count_views),commentCount:parseInt(a.count_comments),title:a.title._content,description:a.description._content,primary_photo_server:a.primary_photo_server,primary_photo_farm:a.primary_photo_farm,primary_photo_secret:a.primary_photo_secret},i.addOrUpdate(t)})},_processParams:function(e){return{gallery_id:e.id}}}},"@VERSION@",{requires:["flickr-promise","api-helper","url-helper"],optional:["gallery-info-models","person-models"]});YUI.add("flickr-galleries-comments-addComment-creator",function(e,t){"use strict";e.namespace("ModelCreators")["flickr-galleries-comments-addComment"]={run:function(r,n){var o=this;return e.Promise.all([n.callAPI("flickr.galleries.comments.addComment",this._processParams(r)),n.getModelRegistry("person-models"),n.getModelRegistry("gallery-comment-models")]).then(function(e){return o._processResponse(e,r,n)},e.FetcherErrorLogger(t))},_processParams:function(e){return{gallery_id:e.ownerId+"-"+e.galleryId,comment_text:e.commentText}},_processResponse:function(e,t,r){var n=e[0],o=(e[1],e[2]),a=n.comment;return r.getModel("person-models",t.authorId).then(function(e){o.addOrUpdate({id:a.id,author:e,authorUsername:a.authorname,authorId:a.author,date:a.dateCreate,permalink:a.permalink,content:a.content,contentSecure:a.secureComment?a.secureComment.content:a.content,contentRaw:a.rawComment?a.rawComment.content:a.content})}),n}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-galleries-comments-deleteComment-deletor",function(e,o){"use strict";e.namespace("ModelDeletors")["flickr-galleries-comments-deleteComment"]={run:function(r,s){var t=this;return e.Promise.all([s.callAPI("flickr.galleries.comments.deleteComment",this._processParams(r)),s.getModel("gallery-info-models",r.galleryId)]).then(function(e){t._processResponse(e,r,s)},e.FetcherErrorLogger(o))},_processParams:function(e){return{comment_id:e.commentId}},_processResponse:function(e,o,r){e[0],e[1].getValue("comments").removeFromList(o.commentId)}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-galleries-comments-editComment-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-galleries-comments-editComment"]={run:function(n,o){var r=this;return e.Promise.all([o.callAPI("flickr.galleries.comments.editComment",this._processParams(n)),o.getModel("gallery-comment-models",n.commentId)]).then(function(e){return r._processResponse(e,n,o)},e.FetcherErrorLogger(t))},_processParams:function(e){return{comment_id:e.commentId,comment_text:e.content}},_processResponse:function(e,t,n){e[0];var o=e[1];return o.setValues({content:t.content,contentSecure:t.content,contentRaw:t.content}),o}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("gallery-comment-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-galleries-comments-addComment"].run(t,this.appContext)},delete:function(t){return e.ModelDeletors["flickr-galleries-comments-deleteComment"].run(t,this.appContext)},update:function(t,r,n){return e.ModelUpdaters["flickr-galleries-comments-editComment"].run({commentId:r.id,content:r.content},n)}},attributes:{author:{isModel:!0},authorUsername:{},authorId:{},date:{},timeago:{readOnly:!0,derivedBy:["date"],getter:function(t,r){return e.moment.unix(this.getValue(r,"date"))}},permalink:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},content:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},contentSecure:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},contentRaw:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}}}})},"@VERSION@",{requires:["flickr-model-registry","moment","flickr-galleries-comments-addComment-creator","flickr-galleries-comments-deleteComment-deletor","flickr-galleries-comments-editComment-updater"]});YUI.add("flickr-galleries-comments-getList-fetcher",function(e,r){"use strict";e.namespace("ListFetchers")["flickr-galleries-comments-getList"]={run:function(t,o){var s=this,n=this._processParams(t);return e.FlickrPromise({apiResponse:o.callAPI("flickr.galleries.comments.getList",n),galleryInfoModelRegistry:o.getModelRegistry("gallery-info-models"),galleryCommentModelRegistry:o.getModelRegistry("gallery-comment-models"),personModelRegistry:o.getModelRegistry("person-models")}).then(function(e){return s._processResponse(e,t,o)},e.FetcherErrorLogger(r))},_processResponse:function(r,t,o){var s=r.apiResponse,n=r.galleryInfoModelRegistry,a=r.galleryCommentModelRegistry,l=r.personModelRegistry,i=[];return s.comments&&(s.comments.comment.forEach(function(r,t){var o=l.addOrUpdate(e.APIHelper.response.parsePerson({nsid:r.author,isDeleted:r.authorIsDeleted,pathAlias:r.pathAlias,username:r.authorname,realname:r.realname,isAdFree:r.isAdFree,isPro:r.isPro,iconurls:r.iconurls,location:r.location}));i.push(a.addOrUpdate({id:r.id,author:o,authorUsername:r.authorname,authorId:r.author,date:r.dateCreate,permalink:r.permalink,content:r.content,contentRaw:r.rawComment?r.rawComment.content:r.content,contentSecure:r.secureComment?r.secureComment.content:r.content}))}),n.getValue(t.id,"comments").addPage({page:t.page,perPage:t.perPage,pageContent:i,totalItems:parseInt(s.comments.total||0,10)})),i},_processParams:function(e){return{gallery_id:e.id,page:e.page||1,per_page:e.perPage||4,secure_image_embeds:e.secureImageEmbeds||1,extras:"icon_urls"}}}},"@VERSION@",{requires:["flickr-promise","api-helper","url-helper"],optional:["gallery-info-models","person-models","gallery-comment-models"]});YUI.add("flickr-galleries-editMeta-updater",function(e,r){"use strict";e.namespace("ModelUpdaters")["flickr-galleries-editMeta"]={run:function(i,l){var t={gallery_id:i.galleryId,title:i.title,description:i.description};return l.callAPI("flickr.galleries.editMeta",t).then(null,e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-galleries-delete-deletor",function(e,r){"use strict";e.namespace("ModelDeletors")["flickr-galleries-delete"]={run:function(l,i){var t={gallery_id:l};return i.callAPI("flickr.galleries.delete",t).then(null,e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("photo-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},galleries:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});YUI.add("flickr-galleries-removePhoto-deletor",function(e,o){"use strict";e.namespace("ModelCreators")["flickr-galleries-removePhoto"]={run:function(t,l){var r={},a=t.galleryCompoundID?t.galleryCompoundID.split("-").pop():t.galleryID;return r.photo_id=t.photoID,r.gallery_id=a,e.Promise.all([l.callAPI("flickr.galleries.removePhoto",r),l.getModel("gallery-models",a),l.getModel("photo-models",t.photoID),l.getModelRegistry("photo-galleries-models"),l.getModelRegistry("photo-contexts-models"),l.getModel("gallery-info-models",a)]).then(function(e){var o=e[0],l=e[1],r=e[2],s=e[3],i=e[4],g=e[5];if("ok"===o.stat)return i.exists(t.photoID)&&i.getValue(t.photoID,"contexts").getFromListByID(a)&&(i.setValue(t.photoID,"totalGalleries",i.getValue(t.photoID,"totalGalleries")-1),i.getValue(t.photoID,"contexts").removeFromList(a)),s.exists(t.photoID)&&s.getValue(t.photoID,"galleries").getFromListByID(a)&&(s.setValue(t.photoID,"total",s.getValue(t.photoID,"total")-1),s.getValue(t.photoID,"galleries").removeFromList(a)),l&&(l.hasPhoto(r.getValue("id"))&&l.removePhoto(r),g.hasPhoto(r.getValue("id"))&&g.getValue("photoList").removeFromList(r.getValue("id")),r.getValue("isVideo")?l.setValue("videoCount",l.getValue("videoCount")-1):l.setValue("photoCount",l.getValue("photoCount")-1),0===l.getValue("photoCount")+l.getValue("videoCount")&&(l.setValue("primary",null),l.setValue("primaryPhotoSizes",{}))),l},e.FetcherErrorLogger(o))}}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models","gallery-info-models"]});YUI.add("flickr-galleries-setPrimaryPhoto-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-galleries-setPrimaryPhoto"]={run:function(l,i){var t={};return t.gallery_id=l.galleryId,t.primary_photo_id=l.photoId,i.callAPI("flickr.galleries.setPrimaryPhoto",t).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("gallery-info-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-galleries-getInfo"].run(t,this.appContext)},updateMeta:function(t,r){return e.ModelUpdaters["flickr-galleries-editMeta"].run(t,r)},delete:function(t,r){return e.ModelDeletors["flickr-galleries-delete"].run(t,r)},removePhoto:function(t,r){return e.ModelCreators["flickr-galleries-removePhoto"].run(t,r)},updatePrimaryPhoto:function(t,r){return e.ModelUpdaters["flickr-galleries-setPrimaryPhoto"].run(t,r)}},updateMetaRemote:function(e,t){return t.galleryId=e,this.remote.updateMeta(t,this.appContext)},deleteRemote:function(e,t){return this.remote.delete(e,this.appContext)},getPrimaryPhotoUrl:function(t,r){return e.URLHelper.getFarmURL(this.getValue(t,"primary_photo_farm"),this.getValue(t,"primary_photo_server"),this.getValue(t,"primaryPhotoId"),this.getValue(t,"primary_photo_secret"),r)},hasPhoto:function(e,t){return this.getValue(e,"photoList").getFromListByID(t)},removePhotoRemote:function(e,t){return this.remote.removePhoto({galleryID:e,photoID:t},this.appContext)},updatePrimaryPhotoRemote:function(e,t){return this.remote.updatePrimaryPhoto({galleryId:e,photoId:t},this.appContext)},attributes:{id:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},compoundId:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(t){var r=this.getValue(t,"owner"),i=e.URLHelper.generatePersonUrls(r);return r?i.galleries+"/"+t:void 0}},owner:{isModel:!0},username:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},primaryPhotoId:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},primaryPhotoSizes:{},dateCreate:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},dateUpdate:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},commentCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},title:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},description:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},photoList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-getPhotos"]}},comments:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-comments-getList"]}},primary_photo_server:{},primary_photo_farm:{},primary_photo_secret:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getInfo-fetcher","flickr-galleries-getPhotos-fetcher","flickr-galleries-comments-getList-fetcher","flickr-galleries-editMeta-updater","flickr-galleries-delete-deletor","flickr-galleries-removePhoto-deletor","flickr-galleries-setPrimaryPhoto-updater","url-helper"],langBundles:["models"]});YUI.add("flickr-galleries-getPhotos-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-galleries-getPhotos"]={run:function(t,l){var r=this;return e.Promise.all([l.callAPI("flickr.galleries.getPhotos",this._processParams(t),!0),l.getModelRegistry("photo-models"),l.getModelRegistry("person-models"),l.getModelRegistry("gallery-models"),l.getModelRegistry("photo-engagement-models"),l.getModelRegistry("photo-stats-models"),l.getModelRegistry("gallery-info-models"),l.getModelRegistry("gallery-photo-models")]).then(function(e){return r._processResponse(e,t)},e.FetcherErrorLogger(o))},_processResponse:function(o,t){var l,r=o[0],s=o[1],a=o[2],g=o[3],i=o[4],n=o[5],p=o[6],d=o[7];if(r&&r.gallery)return r.gallery.owner=r.user,r.gallery.title=r.gallery.title&&r.gallery.title.content?r.gallery.title.content:r.gallery.title,r.gallery.description=r.gallery.description&&r.gallery.description.content?r.gallery.description.content:r.gallery.description,r.gallery.photoCount=r.gallery.countPhotos,r.gallery.videoCount=r.gallery.countVideos,e.APIHelper.response.addContextToRegistry(r.gallery,g,a),l=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:a,photoModelRegistry:s,photoEngagementModelRegistry:i,photoStatsModelRegistry:n}),g.setValue(t.id,"photoPageList",l),p.exists(t.id)&&p.getValue(t.id,"photoList").addPage({page:r.photos.page,perPage:r.photos.perpage,pageContent:l,totalItems:parseInt(r.photos.total||0,10)}),r.photos.photo.forEach(function(e,o){d.addOrUpdate({id:r.gallery.id+"-"+e.id,galleryId:r.gallery.id,photoId:e.id,remark:e.comment?e.comment._content:null,photo:l[o]})}),l},_processParams:function(o){return{gallery_id:o.id,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage||1,page:o.page||1,get_user_info:1,get_gallery_info:1,primary_photo_extras:"url_sq, url_q, url_t, url_s, url_m"}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","gallery-models","photo-engagement-models","photo-stats-models","gallery-info-models"]});YUI.add("flickr-galleries-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-galleries-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.galleries.getContext",this._processParams(t),!0),s.getModelRegistry("gallery-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 3===e.code&&"Photo not in gallery"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){return{gallery_id:o.compoundId||o.id,photo_id:o.photoId,extras:e.APIHelper.request.getRebootPhotoExtras(),num_prev:o.numPrev,num_next:o.numNext,user_id:o.ownerId}},_processResponse:function(o,t){var s,r,n,l,p,a,i=o[0],d=o[1],g=o[2],h=o[3],u=o[4],m=o[5],c=[],y=[],x=g.proxy(t.photoId),M=[];return s=i.nextphotos,r=i.prevphotos,y=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:h,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:h,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),a=d.getValue(t.id,"photoContextList"),l=!!a.hasMinBoundary&&a.hasMinBoundary(),p=!!a.hasMaxBoundary&&a.hasMaxBoundary(),n=a.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:x,next:y,prev:c.reverse(),current:n,hasMin:l,hasMax:p,numNext:t.numNext,numPrev:t.numPrev}),d.setValue(t.id,"photoContextList",M),{next:y,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["gallery-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-galleries-addPhoto-creator",function(e,o){"use strict";e.namespace("ModelCreators")["flickr-galleries-addPhoto"]={run:function(t,l){var a={},s=t.galleryCompoundID?t.galleryCompoundID.split("-").pop():t.galleryID;return a.photo_id=t.photoID,a.gallery_id=s,e.Promise.all([l.callAPI("flickr.galleries.addPhoto",a),l.getModel("gallery-models",s),l.getModel("photo-models",t.photoID),l.getModelRegistry("photo-galleries-models"),l.getModelRegistry("photo-contexts-models")]).then(function(o){var l,a,i=o[0],r=o[1],g=o[2],d=o[3],u=o[4];if("ok"===i.stat)return r&&!r.hasPhoto(g.getValue("id"))&&(r.addPhoto(g),g.getValue("isVideo")?r.setValue("videoCount",r.getValue("videoCount")+1):r.setValue("photoCount",r.getValue("photoCount")+1),1===r.getValue("photoCount")+r.getValue("videoCount")&&(l=g.getValue("sizes"),a={},e.Object.each(l,function(e,o){["m","s","sq","t"].indexOf(o)>-1&&(a[o]={width:e.width,height:e.height,src:e.url})}),r.setValue("primary",s),r.setValue("primaryPhotoSizes",a))),d.exists(t.photoID)&&!d.getValue(t.photoID,"galleries").getFromListByID(r.getValue("id"))&&(d.getValue(t.photoID,"galleries").prependToList(r),d.setValue(t.photoID,"total",d.getValue(t.photoID,"total")+1)),u.exists(t.photoID)&&!u.getValue(t.photoID,"contexts").getFromListByID(r.getValue("id"))&&(u.setValue(t.photoID,"totalGalleries",u.getValue(t.photoID,"totalGalleries")+1),u.getValue(t.photoID,"contexts").appendToList(r)),r},e.FetcherErrorLogger(o))}}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models"]});YUI.add("flickr-galleries-getList-fetcher",function(e,r){"use strict";var t=1,a=500;e.namespace("ListFetchers")["flickr-galleries-getList"]={run:function(t,a,s){var i=this,l=this._processParams(t);return e.Promise.all([a.callAPI("flickr.galleries.getList",l),a.getModelRegistry("person-galleries-models"),a.getModelRegistry("gallery-models"),a.getModel("person-models",t.id||{pathAlias:t.pathAlias})]).then(function(e){return i._processResponse(e,t)},e.FetcherErrorLogger(r))},_processResponse:function(r,s){var i,l=r[0],o=r[1],n=r[2],p=r[3],g=l.galleries,d={},c=[],u={};if(g)return g.gallery&&e.Array.each(g.gallery,function(r,t){var a;a={id:r.id.split("-")[1],compoundId:r.id,title:r.title.content,description:r.description.content,owner:p,primary:r.primaryPhotoId,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(r),photoCount:r.countPhotos,videoCount:r.countVideos,viewCount:r.countViews,commentCount:r.countComments},c.push(n.addOrUpdate(a))}),d={id:p.getValue("id"),pathAlias:p.getValue("pathAlias"),totalItems:g.total||g.gallery.length},i=s.perPage||a,u={perPage:i,page:s.page||t,pageContent:c,totalItems:g.total||g.gallery.length},o.addOrUpdate(d).getValue("galleriesList").addPage(u),u.pageContent},_processParams:function(e){var r={primary_photo_extras:"url_sq, url_q, url_t, url_s, url_m",page:e.page||t,per_page:e.perPage||a};if(e.id)r.user_id=e.id;else{if(!e.pathAlias)throw new Error("[flickr-galleries-getList-fetcher] `id` or `pathAlias` is required.");r.path_alias=e.pathAlias}return r}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-galleries-models","gallery-models","person-models"]});